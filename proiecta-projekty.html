<!doctype html>
<html lang="cs">
<head>

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noindex,nofollow">

  <style>
    :root{
  /* sjednocen√° tmav≈°√≠ tyrkysov√° rodina */
  --bg0:#020814;
  --bg1:#03161d;
  --bg2:#020814;

  --ink:rgba(255,255,255,.94);
  --ink2:rgba(255,255,255,.78);
  --muted:rgba(255,255,255,.68);
  --muted2:rgba(255,255,255,.55);

  --border:rgba(148,227,255,.24);
  --border-soft:rgba(148,227,255,.16);
  --card:rgba(1,10,16,.88);
  --shadow:0 26px 80px rgba(0,0,0,.8);

  --accent:#2dd4bf;
  --accent-soft:rgba(45,212,191,.18);
  --accent-strong:#22c1af;
  --danger:#f97373;
  --danger-soft:rgba(248,113,113,.18);
  --demo:#eab308;
}

body{
  margin:0;
  font-family:"Poppins",system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;
  color:var(--ink);
  background:
    radial-gradient(1200px 820px at 10% 0%, rgba(56,189,248,.24), transparent 60%),
    radial-gradient(1000px 780px at 90% 8%, rgba(45,212,191,.18), transparent 60%),
    /* tmav√Ω spodek pro celou str√°nku */
    radial-gradient(1200px 840px at 50% 120%, rgba(0,0,0,.75), transparent 65%),
    linear-gradient(180deg, var(--bg0) 0%, var(--bg1) 42%, var(--bg2) 100%);
  background-attachment: fixed;
}

    a{color:inherit}

    /* Layout */
    .page{min-height:100vh;display:flex;flex-direction:column;}
    header{
      position:sticky;top:0;z-index:40;
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      background:linear-gradient(180deg,rgba(1,9,15,.92),rgba(1,9,15,.6));
      border-bottom:1px solid rgba(148,227,255,.28);
    }
    .wrap{max-width:1120px;margin:0 auto;padding:14px 18px 22px;}

    .top{
      display:flex;
      align-items:center;
      justify-content:space-between;
      flex-wrap:wrap;
      gap:10px;
    }
    .brand{
      display:flex;
      align-items:center;
      gap:10px;
    }
    .brand-logo{
      width:32px;
      height:32px;
      border-radius:12px;
      overflow:hidden;
      border:1px solid rgba(148,227,255,.4);
      box-shadow:0 8px 26px rgba(0,0,0,.7);
      /* AVATAR PRYƒå ‚Äì jen abstraktn√≠ glow */
      background:
        radial-gradient(circle at 20% 0%, rgba(148,227,255,.55), transparent 55%),
        radial-gradient(circle at 80% 110%, rgba(94,234,212,.5), transparent 60%),
        #020617;
    }
    /* .brand-logo::before ‚Äì odstranƒõno, u≈æ ≈æ√°dn√Ω obr√°zkov√Ω avatar */

    .brand-text b{
      font-family:"Cinzel",serif;
      letter-spacing:.12em;
      font-size:13px;
      text-transform:uppercase;
    }
    .brand-text small{
      display:block;
      font-size:11px;
      color:var(--muted);
    }

    .top-nav{
      display:flex;
      align-items:center;
      gap:8px;
      font-size:12px;
      color:var(--muted2);
    }
    .top-nav a{
      padding:6px 10px;
      border-radius:999px;
      border:1px solid transparent;
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      gap:6px;
      background:rgba(15,23,42,.4);
    }
    .top-nav a:hover{
      border-color:rgba(148,227,255,.4);
      background:rgba(15,23,42,.7);
    }

    main{flex:1}
    .hero{
      display:grid;
      grid-template-columns:minmax(0,1.5fr) minmax(0,1.1fr);
      gap:18px;
      margin-top:12px;
    }
    @media (max-width:880px){
      .hero{grid-template-columns:1fr;gap:16px;}
    }

    .hero-card{
      border-radius:22px;
      border:1px solid var(--border);
      background:linear-gradient(145deg,rgba(3,16,23,.94),rgba(15,23,42,.96));
      box-shadow:var(--shadow);
      padding:18px 18px 16px;
      position:relative;
      overflow:hidden;
    }
    .hero-kicker{
      font-size:11px;
      letter-spacing:.18em;
      text-transform:uppercase;
      color:var(--muted2);
      margin-bottom:4px;
    }
    h1{
      font-family:"Cinzel",serif;
      font-size:clamp(18px,2.5vw,22px);
      letter-spacing:.14em;
      text-transform:uppercase;
      margin:0 0 6px;
    }
    .hero-lead{
      font-size:13px;
      line-height:1.6;
      color:var(--ink2);
      margin:0 0 10px;
    }
    .hero-note{
      font-size:12px;
      color:var(--muted);
      line-height:1.6;
      margin:0;
    }

    .demo-pill-row{
      margin-top:10px;
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      font-size:11px;
    }
    .demo-pill{
      padding:4px 8px;
      border-radius:999px;
      border:1px dashed rgba(234,179,8,.55);
      background:rgba(234,179,8,.10);
      color:rgba(252,211,77,.9);
    }

.hero-side{
  border-radius:22px;
  border:1px solid var(--border-soft);
  background:
    radial-gradient(circle at 0% 0%, rgba(45,212,191,.24), transparent 60%),
    radial-gradient(circle at 100% 100%, rgba(56,189,248,.24), transparent 60%),
    rgba(1,9,15,.92);

  /* ‚¨áÔ∏è D≈ÆLE≈ΩIT√â: nech√°me naho≈ôe m√≠sto pro TV a text d√°me pod ni */
  padding:230px 18px 18px;

  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:flex-start;
  gap:10px;

  position:relative;
  overflow:hidden;
  text-align:center;
}

/* TV r√°m ‚Äì men≈°√≠ a jen naho≈ôe (u≈æ nep≈ôekr√Ωv√° text) */
.hero-side::before{
  content:"";
  position:absolute;
  top:12px;
  left:14px;
  right:14px;
  height:200px;

  background:url("/tv-frame.png") center/contain no-repeat;
  opacity:0.9;
  mix-blend-mode:normal;
  filter:
    drop-shadow(0 18px 28px rgba(0,0,0,.85))
    saturate(1.08)
    contrast(1.10);
  pointer-events:none;
}

/* obsah jde nad TV, ale zaƒç√≠n√° a≈æ POD n√≠ d√≠ky padding-top */
.hero-side > *{
  position:relative;
  z-index:1;
}

/* responzivn√≠ doladƒõn√≠ */
@media (max-width:880px){
  .hero-side{
    padding-top:215px;
  }
  .hero-side::before{
    height:185px;
  }
}
@media (max-width:420px){
  .hero-side{
    padding-top:200px;
  }
  .hero-side::before{
    height:170px;
  }
}
    .hero-side::after{
  content:"";
  position:absolute;
  inset:0;
  border-radius:inherit;
  box-shadow:
    inset 0 0 0 1px rgba(148,227,255,.35),
    inset 0 20px 35px rgba(15,23,42,.85),
    inset 0 -18px 30px rgba(0,0,0,.9);
  opacity:0.85;
  pointer-events:none;
}

    .planBar-label{
      font-size:11px;
      text-transform:uppercase;
      letter-spacing:.16em;
      color:var(--muted2);
    }
    .planBar-main{
      display:flex;
      align-items:center;
      gap:8px;
      margin-top:2px;
      flex-wrap:wrap;
    }
    .planName{
      font-weight:600;
      font-size:13px;
    }
    .planChip{
      padding:4px 10px;
      border-radius:999px;
      font-size:11px;
      border:1px solid rgba(148,227,255,.6);
      background:rgba(15,23,42,.9);
      text-transform:uppercase;
      letter-spacing:.12em;
    }
    .planHint{
      margin-top:6px;
      font-size:11.5px;
      color:var(--muted2);
      line-height:1.6;
    }

    .hero-side-footer{
      margin-top:auto;
      border-top:1px solid rgba(148,227,255,.18);
      padding-top:10px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:8px;
      font-size:11px;
      color:var(--muted2);
    }

    /* TV grid */
    .section-title{
      margin:24px 0 10px;
      font-size:12px;
      text-transform:uppercase;
      letter-spacing:.18em;
      color:var(--muted2);
    }

    .tvGrid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
      gap:16px;
    }

    .tv{
      position:relative;
      border-radius:20px;
      border:1px solid var(--border);
      background:var(--card);
      box-shadow:var(--shadow);
      padding:10px 10px 12px;
      display:flex;
      flex-direction:column;
      gap:8px;
      overflow:hidden;
    }

    .tvHd{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      position:relative;
      z-index:2;
    }
    .pill{
      padding:4px 10px;
      border-radius:999px;
      border:1px solid rgba(148,227,255,.45);
      background:rgba(15,23,42,.9);
      font-size:11px;
      display:inline-flex;
      align-items:center;
      gap:6px;
      color:var(--ink2);
    }
    .pill span{opacity:.85}
    .badge{
      min-width:18px;
      padding:2px 7px;
      border-radius:999px;
      font-size:11px;
      background:rgba(15,23,42,.85);
      border:1px solid rgba(148,227,255,.4);
      text-align:center;
    }

    .demoTag{
      position:absolute;
      left:0;
      right:0;
      bottom:-18px;
      margin:auto;
      width:max-content;
      padding:2px 8px;
      border-radius:999px;
      font-size:10px;
      letter-spacing:.12em;
      text-transform:uppercase;
      background:rgba(250,204,21,.96);
      color:#1f2933;
      box-shadow:0 10px 30px rgba(0,0,0,.55);
    }

    .screen{
      position:relative;
      border-radius:12px;
      border:1px solid rgba(148,227,255,.35);
      background:
        radial-gradient(circle at 0% 0%, rgba(45,212,191,.22), transparent 60%),
        radial-gradient(circle at 100% 100%, rgba(59,130,246,.26), transparent 60%),
        rgba(15,23,42,.96);
      padding:10px 10px 9px;
      font-family:"SF Mono","JetBrains Mono","Menlo",monospace;
      font-size:11.5px;
      line-height:1.5;
      color:rgba(241,245,249,.96);
      min-height:92px;
      overflow:hidden;
    }
    .screen pre{
      margin:0;
      white-space:pre-wrap;
    }
    .fadeEdge{
      position:absolute;
      inset:auto 0 0 0;
      height:26px;
      background:linear-gradient(180deg,transparent,rgba(15,23,42,.98));
      pointer-events:none;
    }

    .tvFt{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:10px;
      font-size:11.5px;
      color:var(--muted);
      flex-wrap:wrap;
    }
    .tvFt strong{
      font-size:12px;
      color:var(--ink2);
      display:block;
    }
    .tvFt span{
      display:block;
    }

    .tvFtActions{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      justify-content:flex-end;
    }

    .tv--demo .screen{
      background:
        radial-gradient(circle at 8% 0%, rgba(234,179,8,.22), transparent 60%),
        radial-gradient(circle at 100% 80%, rgba(56,189,248,.20), transparent 60%),
        rgba(15,23,42,.96);
    }

    .tv--bonus{
      border-style:dashed;
      border-color:rgba(45,212,191,.55);
    }
    .tv--bonus.is-locked{
      opacity:.84;
      border-color:rgba(148,163,184,.45);
      background:rgba(15,23,42,.85);
    }

    .tv--bonus .screen{
      font-size:11px;
    }

    .bonusHint{
      font-size:11px;
      color:var(--muted2);
      margin-top:4px;
    }

    .helpText{
      margin:8px 0 0;
      font-size:11.5px;
      color:var(--muted2);
      line-height:1.6;
    }

    /* Buttons */
    .btn{
      border-radius:999px;
      border:1px solid rgba(148,227,255,.45);
      background:rgba(15,23,42,.95);
      color:var(--ink);
      padding:6px 12px;
      font-size:11.5px;
      font-weight:500;
      display:inline-flex;
      align-items:center;
      gap:6px;
      cursor:pointer;
      transition:all .15s ease-out;
      white-space:nowrap;
    }
    .btn:hover{
      background:linear-gradient(135deg,var(--accent-strong),#60a5fa);
      color:#0b1020;
      box-shadow:0 14px 35px rgba(0,0,0,.65);
    }
    .btn--ghost{
      border-color:rgba(148,227,255,.28);
      background:rgba(15,23,42,.55);
    }
    .btn--ghost:hover{
      background:rgba(15,23,42,.95);
      color:var(--ink);
    }
    .btn--danger{
      border-color:rgba(248,113,113,.65);
      background:rgba(127,29,29,.9);
    }
    .btn--danger:hover{
      background:rgba(220,38,38,.95);
      color:#fff;
    }
    .btn--disabled,
    .btn:disabled{
      cursor:default;
      opacity:.45;
      box-shadow:none;
      background:rgba(15,23,42,.6);
    }

    .hint{
      font-size:11px;
      color:var(--muted2);
      margin-top:8px;
    }

    .emptyMsg{
      font-size:11.5px;
      color:var(--muted2);
      margin:4px 0 0;
    }

    /* Queue section */
    .queueSection{
      margin-top:26px;
      padding:16px 14px 14px;
      border-radius:18px;
      border:1px solid rgba(148,227,255,.28);
      background:rgba(3,13,19,.93);
      box-shadow:0 20px 60px rgba(0,0,0,.8);
    }
    .queueHeader{
      display:flex;
      justify-content:space-between;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
      margin-bottom:10px;
    }
    .queueTitle{
      font-size:13px;
      font-weight:500;
    }
    .queueBadge{
      font-size:11px;
      padding:3px 9px;
      border-radius:999px;
      border:1px solid rgba(148,227,255,.45);
      background:rgba(15,23,42,.9);
      display:inline-flex;
      align-items:center;
      gap:6px;
    }
    #queueCount{font-weight:600;}

    .queueDesc{
      font-size:11.5px;
      color:var(--muted2);
      margin:0 0 10px;
      line-height:1.6;
    }

    .queueList{
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    .queueItem{
      padding:8px 9px;
      border-radius:12px;
      border:1px solid rgba(148,227,255,.24);
      background:rgba(15,23,42,.9);
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      font-size:11.5px;
    }
    .queueMain{
      min-width:0;
    }
    .queueLabel{
      font-weight:500;
      margin-bottom:2px;
    }
    .queueMeta{
      color:var(--muted2);
    }
    .queueActions{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      align-items:center;
      justify-content:flex-end;
    }

    /* Footer */
    footer{
      margin-top:26px;
      padding-top:12px;
      border-top:1px solid rgba(148,227,255,.16);
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      font-size:11px;
      color:var(--muted2);
      justify-content:space-between;
      align-items:center;
    }

    /* Modals */
    .modal-backdrop{
      position:fixed;
      inset:0;
      background:rgba(15,23,42,.72);
      backdrop-filter:blur(18px);
      -webkit-backdrop-filter:blur(18px);
      display:none;
      align-items:center;
      justify-content:center;
      padding:16px;
      z-index:60;
    }
    .modal-backdrop.is-open{display:flex;}

    .modal{
      max-width:520px;
      width:100%;
      border-radius:18px;
      border:1px solid rgba(148,227,255,.4);
      background:rgba(3,13,19,.98);
      box-shadow:0 30px 90px rgba(0,0,0,.9);
      padding:14px 16px 14px;
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    .modal-header{
      display:flex;
      justify-content:space-between;
      gap:8px;
      align-items:flex-start;
      margin-bottom:4px;
    }
    .modal-title{
      font-size:14px;
      font-weight:600;
    }
    .modal-sub{
      font-size:11.5px;
      color:var(--muted2);
      margin-top:2px;
    }
    .modal-close{
      border:none;
      background:transparent;
      color:var(--muted2);
      cursor:pointer;
      padding:2px 4px;
    }
    .modal-body{
      font-size:12px;
      color:var(--ink2);
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    .modal-body p{
      margin:0;
    }

    textarea{
      width:100%;
      min-height:120px;
      border-radius:10px;
      border:1px solid rgba(148,227,255,.35);
      background:rgba(15,23,42,.9);
      color:var(--ink);
      font-family:"Poppins",system-ui,sans-serif;
      font-size:12px;
      padding:8px;
      resize:vertical;
    }

    .field{
      display:flex;
      flex-direction:column;
      gap:4px;
      font-size:12px;
    }
    .field label{
      font-size:11px;
      text-transform:uppercase;
      letter-spacing:.14em;
      color:var(--muted2);
    }
    .field input{
      border-radius:10px;
      border:1px solid rgba(148,227,255,.35);
      background:rgba(15,23,42,.9);
      color:var(--ink);
      font-size:12px;
      padding:7px 8px;
    }

    .modal-footer{
      margin-top:8px;
      padding-top:8px;
      border-top:1px solid rgba(148,227,255,.16);
      display:flex;
      justify-content:flex-end;
      gap:8px;
      flex-wrap:wrap;
    }

    .dangerNote{
      font-size:11px;
      color:var(--danger);
    }

    @media (max-width:640px){
      .hero-side-footer{flex-direction:column;align-items:flex-start;}
      .tvFt{flex-direction:column;align-items:flex-start;}
      .queueItem{flex-direction:column;align-items:flex-start;}
    }
  </style>
</head>
<body>
<div class="page">
  <header>
    <div class="wrap">
      <div class="top">
        <div class="brand">
          <div class="brand-logo" aria-hidden="true"></div>
          <div class="brand-text">
            <b>Proiecta</b>
            <small>Projektov√© m√≠stnosti</small>
          </div>
        </div>
        <nav class="top-nav" aria-label="Navigace">
          <a href="proiecta.html">‚Üê Zpƒõt do d√≠lny</a>
          <a href="praetorium.html">‚Üê Praetorium</a>
          <a href="chronica.html">‚Üê Chronica</a>
        </nav>
      </div>
    </div>
  </header>

  <main>
    <div class="wrap">

      <section class="hero" aria-label="P≈ôehled projektov√Ωch m√≠stnost√≠">
        <div class="hero-card">
          <div class="hero-kicker">PROIECTA ‚Ä¢ M√çSTNOSTI</div>
          <h1>Projektov√© m√≠stnosti ‚Äî TV stƒõna</h1>
          <p class="hero-lead">
            Tady se z opakuj√≠c√≠ch se t√©mat st√°vaj√≠ <b>projektov√© m√≠stnosti</b>.
            Nejprve uk√°zkov√© TV obrazovky, potom tvoje vlastn√≠ m√≠stnosti podle tarifu,
            nakonec bonusov√° mapa pro velk√© mise.
          </p>
          <p class="hero-note">
            V≈°echno v tomhle demu bƒõ≈æ√≠ jen v&nbsp;tv√©m prohl√≠≈æeƒçi ‚Äì lok√°lnƒõ, bez
            ukl√°d√°n√≠ na server. M≈Ø≈æe≈° si zkou≈°et otev√≠rat a mazat m√≠stnosti,
            p≈ôepisovat pozn√°mky a hr√°t si s odkl√°dac√≠m stolem.
          </p>
          <div class="demo-pill-row">
            <span class="demo-pill">üîé T≈ôi velk√© TV = <b>uk√°zkov√© m√≠stnosti</b></span>
            <span class="demo-pill">üìÅ Sekce ‚ÄûMoje m√≠stnosti‚Äú = <b>tvoje projekty</b></span>
            <span class="demo-pill">üß≠ Bonus: <b>MAPA</b> jen pro PREMIUM (v demu uk√°zkovƒõ)</span>
          </div>
        </div>

        <aside class="hero-side" aria-label="Aktivn√≠ tarif v Proiecta">
          <div class="planBar-label">DEMO ‚Ä¢ TARIF</div>
          <div class="planBar-main">
            <span class="planName" id="projPlanName">FREE (demo)</span>
            <span class="planChip" id="projPlanChip" data-plan="free">FREE</span>
          </div>
          <p class="planHint" id="projPlanHint">
            V tomhle demu plat√≠ jednoduch√© limity: FREE ‚Üí 1 vlastn√≠ m√≠stnost,
            PLUS ‚Üí 5 m√≠stnost√≠, PREMIUM ‚Üí neomezenƒõ.
          </p>
          <div class="hero-side-footer">
            <span>Tip: tarif si nastav√≠≈° v mini-loginu nebo v Nastaven√≠.</span>
          </div>
        </aside>
      </section>

      <!-- 1) Uk√°zkov√© obrazovky -->
      <h2 class="section-title">1 ‚Ä¢ Uk√°zkov√© projektov√© m√≠stnosti (DEMO)</h2>
      <section class="tvGrid" aria-label="Uk√°zkov√© TV m√≠stnosti">
        <!-- DOM√ÅCNOST -->
        <article class="tv tv--demo" data-room="demo_domacnost">
          <header class="tvHd">
            <div class="pill">
              <span>üè† DOM√ÅCNOST</span>
            </div>
            <div class="badge">‚àû</div>
            <span class="demoTag">UK√ÅZKA</span>
          </header>
          <div class="screen" aria-hidden="true">
            <pre>
PONDƒöL√ç
  ‚Ä¢ vysypat ko≈° + vyt≈ô√≠t chodbu
  ‚Ä¢ doplnit stelivo pro kocoura
  ‚Ä¢ zkontrolovat lednici (expirace)

ST≈òEDA
  ‚Ä¢ rychl√Ω ‚Äûhotelov√Ω‚Äú √∫klid
  ‚Ä¢ pr√°dlo ‚Üí praƒçka ‚Üí su≈°√°k
            </pre>
            <div class="fadeEdge"></div>
          </div>
          <footer class="tvFt">
            <div>
              <strong>M√≠stnost: ‚ÄûDom√°cnost ‚Äì bƒõ≈æn√© dny‚Äú</strong>
              <span>Bƒõ≈æn√© vƒõci, co se po≈ô√°d vracej√≠ ‚Äì √∫klid, n√°kupy, kocou≈ô√≠ p√≠sek, pap√≠ry‚Ä¶</span>
              <span class="helpText">
                V ostr√© verzi by tu prob√≠haly miniprojekty pro dom√°cnost. Teƒè je to jen uk√°zkov√° obrazovka.
              </span>
            </div>
          </footer>
        </article>

        <!-- RECEPTY -->
        <article class="tv tv--demo" data-room="demo_recepty">
          <header class="tvHd">
            <div class="pill">
              <span>üç≤ RECEPTY</span>
            </div>
            <div class="badge">‚àû</div>
            <span class="demoTag">UK√ÅZKA</span>
          </header>
          <div class="screen" aria-hidden="true">
            <pre>
RECEPTY NA ZIMU
  ‚Ä¢ houbovka podle m√°my
  ‚Ä¢ ‚Äûbezlepkov√Ω‚Äú bramborov√Ω sal√°t
  ‚Ä¢ univerz√°ln√≠ tƒõsto na su≈°enky

TIPY NA L√âTO
  ‚Ä¢ studen√© pol√©vky
  ‚Ä¢ jednoduch√© sal√°ty do krabiƒçek
            </pre>
            <div class="fadeEdge"></div>
          </div>
          <footer class="tvFt">
            <div>
              <strong>M√≠stnost: ‚ÄûRecepty a kuchy≈àsk√© n√°pady‚Äú</strong>
              <span>V≈°echno, co se toƒç√≠ kolem va≈ôen√≠, peƒçen√≠ a ‚Äûco zase dneska k j√≠dlu‚Äú.</span>
              <span class="helpText">
                Tohle je jen demo TV ‚Äì aby bylo vidƒõt, jak m≈Ø≈æe vypadat projekt, kter√Ω nechce≈°
                m√≠chat do ka≈ædodenn√≠ho chatu.
              </span>
            </div>
          </footer>
        </article>

        <!-- VELK√ù PROJEKT -->
        <article class="tv tv--demo" data-room="demo_velky">
          <header class="tvHd">
            <div class="pill">
              <span>üåç VELK√ù PROJEKT</span>
            </div>
            <div class="badge">‚àû</div>
            <span class="demoTag">UK√ÅZKA</span>
          </header>
          <div class="screen" aria-hidden="true">
            <pre>
VELK√ù PROJEKT
  ‚Ä¢ stƒõhov√°n√≠ / rekonstrukce / vƒõt≈°√≠ ≈æivotn√≠ zmƒõna
  ‚Ä¢ seznam krok≈Ø na mƒõs√≠ce dop≈ôedu
  ‚Ä¢ kontroln√≠ body a term√≠ny

TADY BY BYLA:
  ‚Ä¢ ƒçasov√° osa
  ‚Ä¢ pozn√°mky
  ‚Ä¢ odkazy na soubory
            </pre>
            <div class="fadeEdge"></div>
          </div>
          <footer class="tvFt">
            <div>
              <strong>M√≠stnost: ‚ÄûVelk√Ω projekt‚Äú</strong>
              <span>Uk√°zka, jak m≈Ø≈æe vypadat samostatn√° stƒõna pro velkou ≈æivotn√≠ akci.</span>
              <span class="helpText">
                Re√°ln√© projekty si otev≈ôe≈° n√≠≈æ v sekci <b>Moje projektov√© m√≠stnosti</b>.
              </span>
            </div>
          </footer>
        </article>
      </section>

      <!-- 2) Moje projektov√© m√≠stnosti -->
      <h2 class="section-title">2 ‚Ä¢ Moje projektov√© m√≠stnosti (podle tarifu)</h2>
      <section class="tvGrid" aria-label="Tvoje projektov√© m√≠stnosti">
        <article class="tv tv--new">
          <header class="tvHd">
            <div class="pill">
              <span>üß∞ TVOJE M√çSTNOSTI</span>
            </div>
          </header>
          <div class="screen">
            <p><b>Vlastn√≠ projektov√© m√≠stnosti</b></p>
            <p>
              Tady v demu si m≈Ø≈æe≈° otev≈ô√≠t re√°ln√© projektov√© m√≠stnosti ‚Äì t≈ôeba
              ‚ÄûStƒõhov√°n√≠‚Äú, ‚ÄûJazykov√Ω kurz‚Äú nebo ‚ÄûRekonstrukce ob√Ωv√°ku‚Äú.
            </p>
            <ul style="margin:6px 0 0 16px;padding:0;font-size:11.5px;line-height:1.4;">
              <li><b>FREE</b>: 1 vlastn√≠ projektov√° m√≠stnost. Bez dal≈°√≠ch ‚Äûplus‚Äú m√≠stnost√≠.</li>
              <li><b>PLUS</b>: a≈æ 5 vlastn√≠ch m√≠stnost√≠. Taky bez dal≈°√≠ch ‚Äûplus‚Äú m√≠stnost√≠.</li>
              <li><b>PREMIUM</b>: jedna m√≠stnost na start + mo≈ænost neomezen√©ho poƒçtu dal≈°√≠ch projekt≈Ø.</li>
            </ul>
            <p class="hint" id="btnNewRoomHint">
              Limit tarifu se hl√≠d√° automaticky. Jakmile ho dos√°hne≈°, tlaƒç√≠tko se zablokuje.
            </p>
          </div>
          <footer class="tvFt">
            <div>
              <strong>Jak to funguje v demu</strong>
              <span>Ka≈æd√Ω projekt je samostatn√° m√≠stnost s vlastn√≠m polem na pozn√°mky.</span>
            </div>
            <div class="tvFtActions">
              <button class="btn" type="button" id="btnNewRoom">
                ‚ûï Otev≈ô√≠t novou projektovou m√≠stnost
              </button>
            </div>
          </footer>
        </article>

        <div id="customRoomsMount" class="tvGrid" aria-label="Seznam vlastn√≠ch projektov√Ωch m√≠stnost√≠">
          <!-- Dynamicky doplnƒõno JS -->
        </div>
      </section>

            <!-- 3) Bonusy PREMIUM ‚Äì mapa v√Ωprav -->
      <h2 class="section-title">3 ‚Ä¢ Bonusy PREMIUM ‚Äì mapa v√Ωprav</h2>
      <section class="tvGrid" aria-label="Bonusov√© m√≠stnosti PREMIUM">
        <article class="tv tv--bonus" id="tvMap">
          <header class="tvHd">
            <div class="pill">
              <span>üß≠ BONUS: mapa v√Ωprav</span>
            </div>
          </header>
          <div class="screen" aria-hidden="true">
            <pre>
MAPA V√ùPRAV (UK√ÅZKA)
  ‚Ä¢ BLOK 1 ‚Äì c√≠l & cesta
  ‚Ä¢ BLOK 2 ‚Äì balic√≠ checklist
  ‚Ä¢ BLOK 3 ‚Äì pap√≠ry & rezervace
  ‚Ä¢ BLOK 4 ‚Äì drobnosti ‚Äûna klid du≈°e‚Äú

V ostr√© verzi:
  ‚Ä¢ dovolen√©, v√Ωlety, doktory i sch≈Øzky na jedn√© mapƒõ
  ‚Ä¢ propojen√≠ s Chronicou (term√≠ny) a Sigmou (p≈ôipom√≠nky)
  ‚Ä¢ export jako osobn√≠ ‚Äûbatoh na cesty‚Äú
            </pre>
            <div class="fadeEdge"></div>
          </div>
          <footer class="tvFt">
            <div>
              <strong>Mapa v√Ωprav (PREMIUM bonus)</strong>
              <span class="bonusHint tvMapTag">
                V√°≈æn√© vƒõci (cesty, doktory, sch≈Øzky) v hrav√© formƒõ. V demu n√°hled pro v≈°echny,
                v ostr√© verzi kl√≠ƒçov√° PREMIUM m√≠stnost.
              </span>
            </div>
            <div class="tvFtActions">
              <button class="btn btn--ghost" type="button" id="btnOpenMap">
                üß≠ Otev≈ô√≠t mapu v√Ωprav
              </button>
            </div>
          </footer>
        </article>
      </section>

            <!-- Odkl√°dac√≠ st≈Øl -->
      <section class="queueSection" aria-label="Odkl√°dac√≠ st≈Øl ‚Äì demo">
        <div class="queueHeader">
          <div>
            <div class="queueTitle">Odkl√°dac√≠ st≈Øl ‚Äì fronta z d√≠lny (DEMO)</div>
            <p class="queueDesc">
              Tady v demu m√°≈° p√°r uk√°zkov√Ωch polo≈æek ‚Äûz d√≠lny‚Äú. M≈Ø≈æe≈° je
              <b>p≈ôev√©st do nov√© projektov√© m√≠stnosti</b> nebo je <b>smazat</b>.
              V&nbsp;demu sem m≈Ø≈æe≈° pos√≠lat vƒõci p≈ô√≠mo z D√≠lny (chatu)
              p≈ôes tlaƒç√≠tko <b>‚Äûüì¶ Do projektu‚Äú</b> u polo≈æek na odkl√°dac√≠m stolu.
            </p>
          </div>
          <div class="queueBadge">
            <span>Na stole:</span>
            <span id="queueCount">0</span>
          </div>
        </div>
        <div id="queueMount" class="queueList">
          <!-- pln√≠ JS -->
        </div>
      </section>

      <footer>
        <span>Proiecta ‚Ä¢ Projektov√© m√≠stnosti</span>
        <span>DEMO ‚Ä¢ v≈°echna data z≈Øst√°vaj√≠ jen v&nbsp;tv√©m prohl√≠≈æeƒçi.</span>
      </footer>

    </div>
  </main>
</div>

<!-- Mod√°l: detail projektov√© m√≠stnosti -->
<div class="modal-backdrop" id="roomModal" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="roomModalTitle">
    <div class="modal-header">
      <div>
        <div class="modal-title" id="roomModalTitle" data-room-title>Projektov√° m√≠stnost</div>
        <div class="modal-sub" data-room-purpose>Vlastn√≠ projektov√° m√≠stnost.</div>
      </div>
      <button class="modal-close" type="button" data-close-room>‚úï</button>
    </div>
    <div class="modal-body">
      <p>
        Tohle je jednoduch√Ω n√°hled toho, jak m≈Ø≈æe vypadat psac√≠ prostor uvnit≈ô projektov√© m√≠stnosti.
        V≈°echno, co sem nap√≠≈°e≈°, se ukl√°d√° jen u tebe v prohl√≠≈æeƒçi.
      </p>
      <div class="field">
        <label for="roomNotes">Pozn√°mky k projektu</label>
        <textarea id="roomNotes" placeholder="Sem pat≈ô√≠ kostra projektu, miln√≠ky, n√°pady‚Ä¶"></textarea>
      </div>
      <p class="dangerNote">
        Pozor: v DEMO verzi nejde nic exportovat ven. Smaz√°n√≠ m√≠stnosti je nevratn√©.
      </p>
    </div>
    <div class="modal-footer">
      <button class="btn btn--ghost" type="button" data-delete-room>üóë Smazat m√≠stnost</button>
      <button class="btn btn--ghost" type="button" data-close-room>Zav≈ô√≠t</button>
      <button class="btn" type="button" data-save-room>üíæ Ulo≈æit pozn√°mky</button>
    </div>
  </div>
</div>

<!-- Mod√°l: vytvo≈ôen√≠ nov√© m√≠stnosti -->
<div class="modal-backdrop" id="createRoomModal" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="createRoomTitle">
    <div class="modal-header">
      <div>
        <div class="modal-title" id="createRoomTitle">Nov√° projektov√° m√≠stnost</div>
        <div class="modal-sub">
          Kr√°tce pojmenuj projekt a napi≈°, proƒç si zaslou≈æ√≠ vlastn√≠ m√≠stnost.
        </div>
      </div>
      <button class="modal-close" type="button" onclick="(function(){document.getElementById('createRoomModal').classList.remove('is-open');})();">‚úï</button>
    </div>
    <div class="modal-body">
      <form id="createRoomForm" onsubmit="return false;">
        <div class="field">
          <label for="roomName">N√°zev m√≠stnosti</label>
          <input id="roomName" name="roomName" type="text" maxlength="60"
                 placeholder="Nap≈ô. Jazykov√Ω kurz, Rekonstrukce bytu‚Ä¶" required>
        </div>
        <div class="field">
          <label for="roomPurpose">Proƒç tahle m√≠stnost?</label>
          <input id="roomPurpose" name="roomPurpose" type="text" maxlength="140"
                 placeholder="Struƒçnƒõ: k ƒçemu tenhle projekt slou≈æ√≠?">
        </div>
      </form>
      <p class="hint">
        V demu se vytvo≈ô√≠ jen jednoduch√° m√≠stnost s jedn√≠m polem na pozn√°mky.
        ≈Ω√°dn√° data nejdou ven, v≈°echno je ulo≈æen√© jen u tebe.
      </p>
    </div>
    <div class="modal-footer">
      <button class="btn btn--ghost" type="button"
              onclick="(function(){document.getElementById('createRoomModal').classList.remove('is-open');})();">
        Zru≈°it
      </button>
      <button class="btn" type="button" id="btnCreateRoom">
        ‚úÖ Vytvo≈ôit m√≠stnost
      </button>
    </div>
  </div>
</div>

<!-- Mod√°l: info o mapƒõ pro ne-PREMIUM -->
<div class="modal-backdrop" id="mapInfoModal" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="mapInfoTitle">
    <div class="modal-header">
      <div>
        <div class="modal-title" id="mapInfoTitle">Mapa v√Ωprav ‚Äì PREMIUM bonus</div>
        <div class="modal-sub">
          Tohle je uk√°zkov√° PREMIUM m√≠stnost. V demu ji m≈Ø≈æe≈° jen prohl√≠≈æet ‚Äì pln√© funkce se otev≈ôou a≈æ v ostr√© verzi.
        </div>
      </div>
      <button class="modal-close" type="button" data-close-map>‚úï</button>
    </div>
    <div class="modal-body">
      <p>
        V ostr√© verzi bude Mapa v√Ωprav hl√≠dat dovolen√©, v√Ωlety, doktory i pracovn√≠ sch≈Øzky, propojen√© s Chronicou a Sigmou.
      </p>
      <p>
        Tady v demu si m≈Ø≈æe≈° jen nastavit typ v√Ωpravy, checklist a pocit bezpeƒçn√©ho odchodu z domu. ≈Ω√°dn√° data nejdou na server.
      </p>
    </div>
    <div class="modal-footer">
      <button class="btn btn--ghost" type="button" data-close-map>Zav≈ô√≠t</button>
    </div>
  </div>
</div>

<!-- Mod√°l: potvrzen√≠ smaz√°n√≠ -->
<div class="modal-backdrop" id="confirmModal" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="confirmTitle">
    <div class="modal-header">
      <div class="modal-title" id="confirmTitle">Smazat projektovou m√≠stnost?</div>
      <button class="modal-close" type="button" data-cancel-delete>‚úï</button>
    </div>
    <div class="modal-body">
      <p>
        Opravdu chce≈° tuhle projektovou m√≠stnost smazat?
        V≈°echno, co do n√≠ m√°≈° zapsan√©, se v demu nen√°vratnƒõ ztrat√≠.
      </p>
      <p class="dangerNote">
        V ostr√© verzi by ≈°lo p≈ôesunout m√≠stnost do archivu. Tady v demu je smaz√°n√≠ definitivn√≠.
      </p>
    </div>
    <div class="modal-footer">
      <button class="btn btn--ghost" type="button" data-cancel-delete>Ne, ponechat</button>
      <button class="btn btn--danger" type="button" data-confirm-delete>Ano, smazat</button>
    </div>
  </div>
</div>

<script>
(() => {
  const PLAN_KEY = 'lm_plan';
  const PLAN_LIMITS = {
    FREE: 1,
    PLUS: 5,
    PREMIUM: Infinity
  };

  const KEY_ROOMS = 'LM_PROIECTA_CUSTOM_ROOMS_V1';
  const KEY_ROOM_TEXTS = 'LM_PROIECTA_ROOM_TEXTS_V1';
  const KEY_QUEUE = "LM_PROIECTA_QUEUE_DEMO_CS";

  let rooms = [];
  let roomTexts = {};
  let queue = [];
  let activeRoomKey = null;
  let deleteRoomKey = null;
  let queueSourceItemIndex = null;

  function getPlan() {
    const raw = (typeof localStorage !== 'undefined')
      ? localStorage.getItem(PLAN_KEY)
      : null;
    const norm = (raw || 'FREE').toUpperCase();
    if (norm === 'PLUS' || norm === 'PREMIUM') return norm;
    return 'FREE';
  }

  function planLabel(plan) {
    if (plan === 'PLUS') return 'PLUS (st≈ôedn√≠ patro)';
    if (plan === 'PREMIUM') return 'PREMIUM (v≈°echno otev≈ôen√©)';
    return 'FREE (z√°kladn√≠ dem√≠ƒçko)';
  }

  function saveRooms() {
    if (typeof localStorage === 'undefined') return;
    localStorage.setItem(KEY_ROOMS, JSON.stringify(rooms));
  }

  function saveTexts() {
    if (typeof localStorage === 'undefined') return;
    localStorage.setItem(KEY_ROOM_TEXTS, JSON.stringify(roomTexts));
  }

  function saveQueue() {
    if (typeof localStorage === 'undefined') return;
    localStorage.setItem(KEY_QUEUE, JSON.stringify(queue));
  }

  function renderPlanBar() {
    const plan = getPlan();
    const limit = PLAN_LIMITS[plan] ?? PLAN_LIMITS.FREE;
    const count = rooms.length;

    const nameEl = document.getElementById('projPlanName');
    const chip = document.getElementById('projPlanChip');
    const hint = document.getElementById('projPlanHint');
    const btnNew = document.getElementById('btnNewRoom');
    const newHint = document.getElementById('btnNewRoomHint');

    if (nameEl) nameEl.textContent = planLabel(plan);
    if (chip) {
      chip.textContent = plan;
      chip.setAttribute('data-plan', plan.toLowerCase());
    }

    if (hint) {
      if (plan === 'PREMIUM') {
        hint.textContent = 'PREMIUM v demu: m≈Ø≈æe≈° si zkou≈°et otev√≠rat tolik projektov√Ωch m√≠stnost√≠, kolik uzn√°≈° za vhodn√©.';
      } else if (plan === 'PLUS') {
        hint.textContent = 'PLUS v demu: a≈æ 5 vlastn√≠ch projektov√Ωch m√≠stnost√≠. Ide√°ln√≠ pro nƒõkolik vƒõt≈°√≠ch t√©mat vedle sebe.';
      } else {
        hint.textContent = 'FREE v demu: jedna ostr√° projektov√° m√≠stnost. Staƒç√≠ na otestov√°n√≠, jak ti tenhle syst√©m sed√≠.';
      }
    }

    if (btnNew && newHint) {
      if (limit !== Infinity && count >= limit) {
        btnNew.disabled = true;
        btnNew.classList.add('btn--disabled');
        newHint.textContent =
          plan === 'FREE'
            ? 'Ve FREE m√°≈° v demu dovoleno 1 projektovou m√≠stnost. Zbytek by byl sp√≠≈° stres ne≈æ pomoc.'
            : 'V PLUS pl√°nu je strop 5 projektov√Ωch m√≠stnost√≠ ‚Äì pro demo to √∫plnƒõ staƒç√≠.';
      } else {
        btnNew.disabled = false;
        btnNew.classList.remove('btn--disabled');
        if (limit === Infinity) {
          newHint.textContent = 'PREMIUM: m≈Ø≈æe≈° otev√≠rat dal≈°√≠ a dal≈°√≠ projektov√© m√≠stnosti, jak pot≈ôebuje≈°.';
        } else {
          const remaining = limit - count;
          newHint.textContent =
            'M≈Ø≈æe≈° je≈°tƒõ p≈ôidat ' + remaining +
            (remaining === 1 ? ' m√≠stnost v r√°mci souƒçasn√©ho tarifu.' : ' m√≠stnosti v r√°mci souƒçasn√©ho tarifu.');
        }
      }
    }

    // Map gating (PREMIUM bonus)
    const tvMap = document.getElementById('tvMap');
    const mapTag = document.querySelector('.tvMapTag');
    const btnMap = document.getElementById('btnOpenMap');

    if (tvMap && mapTag && btnMap) {
      if (plan === 'PREMIUM') {
        tvMap.classList.remove('is-locked');
        mapTag.textContent = 'PREMIUM uk√°zka ‚Äì v ostr√© verzi bude tahle m√≠stnost bonus jen pro PREMIUM. Tady v demu je pro tebe p≈ôipraven√Ω vstup na mapu.';
        btnMap.disabled = false;
        btnMap.classList.remove('btn--disabled');
        btnMap.setAttribute('aria-disabled', 'false');
      } else {
        tvMap.classList.add('is-locked');
        mapTag.textContent = 'Tahle m√≠stnost je my≈°len√° jako PREMIUM bonus. V demu ji uvid√≠≈°, ale vstup na mapu je zablokovan√Ω.';
        btnMap.disabled = false; // nech√°me klikatelnou a vysvƒõtl√≠me v JS
        btnMap.classList.remove('btn--disabled');
        btnMap.setAttribute('aria-disabled', 'true');
      }
    }
  }

  function renderRooms() {
    const mount = document.getElementById('customRoomsMount');
    if (!mount) return;
    mount.innerHTML = '';

    if (!rooms.length) {
      const p = document.createElement('p');
      p.className = 'emptyMsg';
      p.textContent = 'Zat√≠m tu nem√°≈° ≈æ√°dnou vlastn√≠ projektovou m√≠stnost. Zaƒçni tlaƒç√≠tkem ‚ÄûOtev≈ô√≠t novou projektovou m√≠stnost‚Äú.';
      mount.appendChild(p);
      return;
    }

    rooms.forEach(room => {
      const art = document.createElement('article');
      art.className = 'tv tv--custom';
      art.dataset.roomId = room.key;

      const hd = document.createElement('header');
      hd.className = 'tvHd';
      const pill = document.createElement('div');
      pill.className = 'pill';
      pill.innerHTML = '<span>üìÅ ' + (room.name || 'Projekt bez n√°zvu') + '</span>';
      hd.appendChild(pill);
      art.appendChild(hd);

      const screen = document.createElement('div');
      screen.className = 'screen';
      const purpose = room.purpose || 'Vlastn√≠ projektov√° m√≠stnost.';
      const html = [
        '<p><b>' + (room.name || 'Projekt bez n√°zvu') + '</b></p>',
        '<p class="muted">' + purpose + '</p>'
      ].join('');
      screen.innerHTML = html + '<div class="fadeEdge"></div>';
      art.appendChild(screen);

      const ft = document.createElement('footer');
      ft.className = 'tvFt';

      const left = document.createElement('div');
      const created = room.createdAt ? new Date(room.createdAt) : new Date();
      left.innerHTML =
        '<strong>Stav m√≠stnosti</strong>' +
        '<span>Otev≈ôeno pro tvoje pozn√°mky.</span>' +
        '<span class="helpText">Zalo≈æeno: ' + created.toLocaleDateString('cs-CZ') + '</span>';

      const actions = document.createElement('div');
      actions.className = 'tvFtActions';

      const btnOpen = document.createElement('button');
      btnOpen.type = 'button';
      btnOpen.className = 'btn btn--ghost';
      btnOpen.textContent = '‚úèÔ∏è Otev≈ô√≠t projekt';
      btnOpen.addEventListener('click', () => openRoom(room.key));

      const btnDelete = document.createElement('button');
      btnDelete.type = 'button';
      btnDelete.className = 'btn btn--danger';
      btnDelete.textContent = 'üóë Smazat';
      btnDelete.addEventListener('click', () => askDeleteRoom(room.key));

      actions.appendChild(btnOpen);
      actions.appendChild(btnDelete);

      ft.appendChild(left);
      ft.appendChild(actions);

      art.appendChild(ft);
      mount.appendChild(art);
    });
  }

  function renderQueue() {
    const mount = document.getElementById('queueMount');
    const counter = document.getElementById('queueCount');
    if (!mount || !counter) return;

    mount.innerHTML = '';

    if (!queue.length) {
      counter.textContent = '0';
      const p = document.createElement('p');
      p.className = 'emptyMsg';
      p.textContent = 'Odkl√°dac√≠ st≈Øl je pr√°zdn√Ω. V demu tu byly uk√°zkov√© polo≈æky ‚Äì teƒè ƒçek√° na tvoje projekty.';
      mount.appendChild(p);
      return;
    }

    counter.textContent = String(queue.length);

    queue.forEach((item, index) => {
      const row = document.createElement('div');
      row.className = 'queueItem';

      const main = document.createElement('div');
      main.className = 'queueMain';

      const label = document.createElement('div');
      label.className = 'queueLabel';
      label.textContent = item.title || item.label || item.topic || ('Polo≈æka ' + (index + 1));

      const meta = document.createElement('div');
      meta.className = 'queueMeta';
      if (item.createdAt) {
        const d = new Date(item.createdAt);
        meta.textContent = 'Zaps√°no: ' + d.toLocaleString('cs-CZ');
      } else {
        meta.textContent = 'Uk√°zkov√° polo≈æka z Proiecta d√≠lny (demo).';
      }

      main.appendChild(label);
      main.appendChild(meta);

      const actions = document.createElement('div');
      actions.className = 'queueActions';

      const btnProject = document.createElement('button');
      btnProject.type = 'button';
      btnProject.className = 'btn btn--ghost';
      btnProject.textContent = '‚û° Vytvo≈ôit projekt z polo≈æky';
      btnProject.addEventListener('click', () => {
        queueSourceItemIndex = index;
        openCreateRoomFromQueue(item);
      });

      const btnDelete = document.createElement('button');
      btnDelete.type = 'button';
      btnDelete.className = 'btn btn--danger';
      btnDelete.textContent = '‚úñ Smazat ze stolu';
      btnDelete.addEventListener('click', () => {
        queue.splice(index, 1);
        saveQueue();
        renderQueue();
      });

      actions.appendChild(btnProject);
      actions.appendChild(btnDelete);

      row.appendChild(main);
      row.appendChild(actions);
      mount.appendChild(row);
    });
  }

  function openRoom(key) {
    const modal = document.getElementById('roomModal');
    if (!modal) return;
    const room = rooms.find(r => r.key === key);
    if (!room) return;

    activeRoomKey = key;

    const titleEl = modal.querySelector('[data-room-title]');
    const purposeEl = modal.querySelector('[data-room-purpose]');
    const notes = document.getElementById('roomNotes');

    if (titleEl) titleEl.textContent = room.name || 'Projekt bez n√°zvu';
    if (purposeEl) purposeEl.textContent = room.purpose || 'Vlastn√≠ projektov√° m√≠stnost.';
    if (notes) notes.value = roomTexts[key] || '';

    modal.classList.add('is-open');
  }

  function askDeleteRoom(key) {
    deleteRoomKey = key;
    const modal = document.getElementById('confirmModal');
    if (modal) modal.classList.add('is-open');
  }

  function saveRoomNotes() {
    if (!activeRoomKey) return;
    const notes = document.getElementById('roomNotes');
    if (!notes) return;
    roomTexts[activeRoomKey] = notes.value || '';
    saveTexts();
  }

  function createRoomFromForm() {
    const form = document.getElementById('createRoomForm');
    if (!form) return;
    const name = (form.roomName.value || '').trim();
    const purpose = (form.roomPurpose.value || '').trim();
    if (!name) {
      form.roomName.focus();
      return;
    }

    const plan = getPlan();
    const limit = PLAN_LIMITS[plan] ?? PLAN_LIMITS.FREE;
    if (rooms.length >= limit) {
      // jen tich√° ochrana ‚Äì UI by to mƒõlo zablokovat u≈æ d≈ô√≠v
      return;
    }

    const key = 'room_' + Date.now();
    rooms.push({
      key,
      name,
      purpose,
      state: 'open',
      createdAt: Date.now()
    });
    saveRooms();

    // pokud vznikla m√≠stnost z polo≈æky odkl√°dac√≠ho stolu ‚Üí polo≈æku sund√°me
    if (queueSourceItemIndex !== null && queueSourceItemIndex >= 0 && queueSourceItemIndex < queue.length) {
      queue.splice(queueSourceItemIndex, 1);
      queueSourceItemIndex = null;
      saveQueue();
    }

    const modal = document.getElementById('createRoomModal');
    if (modal) modal.classList.remove('is-open');

    renderRooms();
    renderQueue();
    renderPlanBar();

    // hned otev≈ôeme novou m√≠stnost
    openRoom(key);
  }

  function openCreateRoomFromQueue(item) {
    const modal = document.getElementById('createRoomModal');
    const form = document.getElementById('createRoomForm');
    if (!modal || !form) return;

    form.reset();
    form.roomName.value = (item.title || item.label || item.topic || '').toString().slice(0, 60);
    const descSource = item.text || item.body || item.note || '';
    form.roomPurpose.value = descSource
      ? descSource.toString().slice(0, 120)
      : 'Projekt vznikl√Ω z odkl√°dac√≠ho stolu.';

    modal.classList.add('is-open');
  }

  function closeModal(id) {
    const modal = document.getElementById(id);
    if (modal) modal.classList.remove('is-open');
  }

  function init() {
    // naƒçten√≠ rooms
    try {
      const rawRooms = localStorage.getItem(KEY_ROOMS);
      rooms = rawRooms ? JSON.parse(rawRooms) : [];
    } catch (e) {
      rooms = [];
    }

    // naƒçten√≠ text≈Ø
    try {
      const rawTexts = localStorage.getItem(KEY_ROOM_TEXTS);
      roomTexts = rawTexts ? JSON.parse(rawTexts) : {};
    } catch (e) {
      roomTexts = {};
    }

    // naƒçten√≠ fronty ‚Äì pokud nic, vytvo≈ô√≠me uk√°zku
    try {
      const rawQueue = localStorage.getItem(KEY_QUEUE);
      if (rawQueue) {
        queue = JSON.parse(rawQueue) || [];
      } else {
        queue = [
          {
            id: 'demo1',
            title: 'Angliƒçtina ‚Äì kurzy',
            text: 'ƒåast√© t√©ma v d√≠lnƒõ: uƒçit se jazyk systematicky, ne jen n√°razovƒõ.'
          },
          {
            id: 'demo2',
            title: 'Rekonstrukce ƒç√°sti bytu',
            text: 'Velk√Ω projekt po kousk√°ch ‚Äì vhodn√Ω kandid√°t na vlastn√≠ m√≠stnost.'
          },
          {
            id: 'demo3',
            title: 'Stƒõhov√°n√≠ / nov√© hn√≠zdo',
            text: 'Bal√≠c√≠ seznamy, √∫≈ôady, pap√≠ry a pap√≠rov√Ω chaos ‚Äì ide√°ln√≠ p≈ô√≠klad pro projektovou mapu.'
          }
        ];
        saveQueue();
      }
    } catch (e) {
      queue = [];
    }

    renderPlanBar();
    renderRooms();
    renderQueue();

    // Nov√° m√≠stnost
    const btnNewRoom = document.getElementById('btnNewRoom');
    if (btnNewRoom) {
      btnNewRoom.addEventListener('click', () => {
        queueSourceItemIndex = null;
        const modal = document.getElementById('createRoomModal');
        const form = document.getElementById('createRoomForm');
        if (form) form.reset();
        if (modal) modal.classList.add('is-open');
      });
    }

    // Tvorba m√≠stnosti z mod√°lu
    const btnCreateRoom = document.getElementById('btnCreateRoom');
    if (btnCreateRoom) {
      btnCreateRoom.addEventListener('click', createRoomFromForm);
    }

    // Room modal buttons
    const roomModal = document.getElementById('roomModal');
    if (roomModal) {
      roomModal.querySelectorAll('[data-close-room]').forEach(btn => {
        btn.addEventListener('click', () => {
          closeModal('roomModal');
          activeRoomKey = null;
        });
      });
      const btnSave = roomModal.querySelector('[data-save-room]');
      if (btnSave) {
        btnSave.addEventListener('click', () => {
          saveRoomNotes();
          closeModal('roomModal');
        });
      }
      const btnDelete = roomModal.querySelector('[data-delete-room]');
      if (btnDelete) {
        btnDelete.addEventListener('click', () => {
          if (!activeRoomKey) return;
          askDeleteRoom(activeRoomKey);
        });
      }
    }

    // Confirm delete modal
    const confirmModal = document.getElementById('confirmModal');
    if (confirmModal) {
      const btnCancel = confirmModal.querySelector('[data-cancel-delete]');
      const btnConfirm = confirmModal.querySelector('[data-confirm-delete]');
      if (btnCancel) {
        btnCancel.addEventListener('click', () => {
          deleteRoomKey = null;
          closeModal('confirmModal');
        });
      }
      if (btnConfirm) {
        btnConfirm.addEventListener('click', () => {
          if (!deleteRoomKey) return;
          rooms = rooms.filter(r => r.key !== deleteRoomKey);
          delete roomTexts[deleteRoomKey];
          saveRooms();
          saveTexts();
          renderRooms();
          renderPlanBar();
          closeModal('confirmModal');
          if (activeRoomKey === deleteRoomKey) {
            activeRoomKey = null;
            closeModal('roomModal');
          }
        });
      }
    }

        // Map button ‚Äì PREMIUM only (bez syst√©mov√©ho alertu)
    const btnMap = document.getElementById('btnOpenMap');
    if (btnMap) {
      btnMap.addEventListener('click', () => {
        const plan = getPlan();
        if (plan !== 'PREMIUM') {
          const info = document.getElementById('mapInfoModal');
          if (info) info.classList.add('is-open');
          return;
        }
        window.location.href = 'map.html';
      });
    }

    // Map info modal ‚Äì zav√≠r√°n√≠
    const mapInfoModal = document.getElementById('mapInfoModal');
    if (mapInfoModal) {
      mapInfoModal.querySelectorAll('[data-close-map]').forEach(btn => {
        btn.addEventListener('click', () => {
          mapInfoModal.classList.remove('is-open');
        });
      });
    }

    // ESC = zav≈ô√≠t mod√°ly
    document.addEventListener('keydown', (ev) => {
            if (ev.key === 'Escape') {
        closeModal('roomModal');
        closeModal('createRoomModal');
        closeModal('confirmModal');
        closeModal('mapInfoModal');
        activeRoomKey = null;
        deleteRoomKey = null;
      }
    });
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
  } else {
    init();
  }
})();
</script>
</body>
</html>