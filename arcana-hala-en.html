<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noindex,nofollow">

  <style>
    :root{
      --bg: #050608;
      --bg-soft: #0b0f13;
      --bg-softer: #10151b;
      --bg-deep: #07090d;

      --ink: #f5f5f5;
      --ink-soft: #c6c8cd;
      --ink-soft2: #a5a8af;
      --ink-muted: #81858d;

      --border-soft: rgba(255,255,255,.12);
      --border-strong: rgba(255,255,255,.26);

      --danger: #ff4d4f;
      --danger-soft: rgba(255,77,79,.16);

      --radius-lg: 20px;
      --radius-md: 13px;
      --radius-pill: 999px;

      --shadow-soft: 0 18px 40px rgba(0,0,0,.8);
      --shadow-chip: 0 10px 26px rgba(0,0,0,.85);

      --font-sans: system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
      --font-mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }

    *{ box-sizing:border-box; }

    [hidden]{
      display:none !important;
    }

    html{
      -webkit-text-size-adjust:100%;
      text-size-adjust:100%;
    }

    body{
      margin:0;
      min-height:100vh;
      background:
        radial-gradient(circle at 0 0, rgba(255,255,255,.05) 0, transparent 45%),
        radial-gradient(circle at 100% 100%, rgba(0,0,0,.8) 0, transparent 55%),
        var(--bg);
      color:var(--ink);
      font-family:var(--font-sans);
    }

    .shell{
      min-height:100vh;
      max-width:1120px;
      margin:0 auto;
      padding:16px;
      display:flex;
      flex-direction:column;
    }

    @media (min-width:960px){
      .shell{
        padding:22px 22px 26px;
      }
    }

    /* Header */

    .shell-header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:16px;
      margin-bottom:18px;
    }

    .brand{
      display:flex;
      align-items:center;
      gap:10px;
      min-width:0;
    }

    .brand-logo{
      width:34px;
      height:34px;
      border-radius:50%;
      border:1px solid rgba(255,255,255,.24);
      background:#11151b;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
      box-shadow:0 10px 24px rgba(0,0,0,.9);
    }

    .brand-logo img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }

    .brand-title{
      display:flex;
      flex-direction:column;
      gap:2px;
    }

    .brand-title-main{
      font-size:14px;
      letter-spacing:.12em;
      text-transform:uppercase;
    }

    .brand-title-sub{
      font-size:12px;
      color:var(--ink-soft2);
    }

    .shell-nav{
      display:flex;
      align-items:center;
      gap:8px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    .nav-link{
      font-size:12px;
      padding:7px 11px;
      border-radius:var(--radius-pill);
      border:1px solid rgba(255,255,255,.16);
      background:rgba(7,9,12,.96);
      color:var(--ink-soft);
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      gap:6px;
      box-shadow:var(--shadow-chip);
    }

    .nav-link span:first-child{
      font-size:14px;
    }

    .nav-link:hover{
      border-color:rgba(255,255,255,.35);
      color:var(--ink);
    }

    .plan-badge{
      font-size:11px;
      padding:6px 10px;
      border-radius:var(--radius-pill);
      border:1px solid rgba(255,255,255,.2);
      background:#0b0f13;
      color:var(--ink-soft);
      box-shadow:var(--shadow-chip);
      white-space:nowrap;
    }

    /* Main panel */

    .shell-main{
      flex:1;
      display:flex;
      flex-direction:column;
      gap:18px;
      position:relative;
    }

    .halo{
      position:absolute;
      inset:auto;
      left:50%;
      top:40%;
      width:420px;
      height:420px;
      background:
        radial-gradient(circle at 50% 50%, rgba(255,255,255,.07) 0, transparent 65%);
      opacity:.45;
      filter:blur(12px);
      transform:translateX(-50%);
      pointer-events:none;
      z-index:-1;
    }

    .panel-main{
      position:relative;
      border-radius:24px;
      background:var(--bg-soft);
      border:1px solid var(--border-soft);
      box-shadow:var(--shadow-soft);
      padding:16px;
      display:flex;
      flex-direction:column;
      gap:18px;
      overflow:hidden;
    }

    @media (min-width:960px){
      .panel-main{
        padding:20px;
        gap:20px;
      }
    }

    .panel-header{
      display:flex;
      flex-direction:column;
      gap:6px;
      margin-bottom:4px;
    }

    .panel-kicker{
      font-size:11px;
      letter-spacing:.16em;
      text-transform:uppercase;
      color:var(--ink-muted);
    }

    .panel-title-row{
      display:flex;
      align-items:center;
      flex-wrap:wrap;
      gap:8px;
    }

    .panel-title{
      font-size:18px;
      letter-spacing:.08em;
      text-transform:uppercase;
    }

    .panel-lead{
      font-size:13px;
      color:var(--ink-soft);
      max-width:560px;
    }

    .panel-note{
      font-size:11px;
      color:var(--ink-muted);
    }

    .panel-note .warning{
      color:var(--danger);
      font-weight:600;
    }

    /* Lock overlay */

    .lock-overlay{
      position:absolute;
      inset:0;
      background:
        radial-gradient(circle at 50% 0, rgba(0,0,0,.7) 0, rgba(0,0,0,.92) 65%);
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      padding:24px 18px;
      text-align:center;
      gap:8px;
      z-index:5;
    }

    .lock-title{
      font-size:14px;
      letter-spacing:.16em;
      text-transform:uppercase;
      color:var(--ink-soft);
    }

    .lock-text{
      font-size:12px;
      color:var(--ink-soft2);
      max-width:360px;
    }

    .lock-chip{
      font-size:11px;
      padding:4px 9px;
      border-radius:var(--radius-pill);
      border:1px solid var(--danger);
      background:var(--danger-soft);
      color:var(--danger);
    }

    /* Layout 2 columns */

    .content-grid{
      display:flex;
      flex-direction:column;
      gap:16px;
    }

    @media (min-width:960px){
      .content-grid{
        flex-direction:row;
        align-items:flex-start;
      }
      .col-zones{
        flex:0 0 40%;
      }
      .col-whisper{
        flex:1;
      }
    }

    .col-zones,
    .col-whisper{
      border-radius:var(--radius-lg);
      background:var(--bg-softer);
      border:1px solid var(--border-soft);
      padding:12px;
      position:relative;
    }

    @media (min-width:960px){
      .col-zones,
      .col-whisper{
        padding:14px 14px 15px;
      }
    }

    .section-title{
      font-size:13px;
      letter-spacing:.14em;
      text-transform:uppercase;
      color:var(--ink-soft2);
      margin-bottom:4px;
    }

    .section-sub{
      font-size:12px;
      color:var(--ink-soft2);
      margin-bottom:10px;
    }

    /* Vault zones */

    .zone-grid{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:8px;
    }

    @media (max-width:540px){
      .zone-grid{
        grid-template-columns:1fr;
      }
    }

    .zone-card{
      position:relative;
      padding:9px 9px 8px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.14);
      background:#0b0f13;
      color:var(--ink-soft);
      text-align:left;
      cursor:pointer;
      display:flex;
      flex-direction:column;
      gap:4px;
      box-shadow:0 10px 22px rgba(0,0,0,.85);
      min-height:72px;
      transition:border-color .16s ease, box-shadow .16s ease, transform .1s ease, background .16s ease;
    }

    .zone-card:hover{
      border-color:var(--border-strong);
      box-shadow:0 12px 26px rgba(0,0,0,.95);
      transform:translateY(-1px);
    }

    .zone-card.is-active{
      border-color:var(--border-strong);
      background:#141922;
      box-shadow:0 14px 30px rgba(0,0,0,.95);
    }

    .zone-card.locked{
      cursor:default;
      opacity:.7;
      border-style:dashed;
      border-color:rgba(255,255,255,.24);
      background:
        repeating-linear-gradient(135deg, rgba(255,255,255,.04) 0, rgba(255,255,255,.04) 2px, rgba(0,0,0,.7) 2px, rgba(0,0,0,.7) 4px);
      box-shadow:none;
      transform:none;
    }

    .zone-name-row{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:6px;
    }

    .zone-name{
      font-size:12.5px;
      letter-spacing:.13em;
      text-transform:uppercase;
      color:var(--ink-soft);
    }

    .zone-tag,
    .zone-lock{
      font-size:10px;
      padding:2px 7px 3px;
      border-radius:var(--radius-pill);
      border:1px solid rgba(255,255,255,.18);
      background:#090c10;
      color:var(--ink-soft2);
      white-space:nowrap;
    }

    .zone-lock{
      border-color:var(--danger);
      background:var(--danger-soft);
      color:var(--danger);
    }

    .zone-desc{
      font-size:11px;
      color:var(--ink-soft2);
    }

    .zone-foot{
      font-size:10px;
      color:var(--ink-muted);
      display:flex;
      align-items:center;
      gap:4px;
    }

    .zone-dot{
      width:6px;
      height:6px;
      border-radius:50%;
      background:radial-gradient(circle at 30% 20%, rgba(255,255,255,.7) 0, rgba(255,255,255,.15) 60%);
      box-shadow:0 0 0 1px rgba(255,255,255,.3);
    }

    .zone-card.zone-pulse{
      box-shadow: 0 0 0 1px rgba(255,255,255,.4),
                  0 0 24px rgba(255,245,200,.75);
      transform: translateY(-1px);
      transition: box-shadow .25s ease, transform .25s ease;
    }

    /* Whisper room */

    .whisper-header{
      display:flex;
      align-items:flex-start;
      gap:10px;
      margin-bottom:10px;
    }

    .whisper-avatar-wrap{
      width:38px;
      height:38px;
      border-radius:50%;
      border:1px solid rgba(255,255,255,.22);
      overflow:hidden;
      box-shadow:0 10px 24px rgba(0,0,0,.9);
      flex-shrink:0;
    }

    .whisper-avatar-wrap img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }

    .whisper-title{
      font-size:13px;
      letter-spacing:.16em;
      text-transform:uppercase;
      color:var(--ink-soft2);
      margin-bottom:2px;
    }

    .whisper-lead{
      font-size:12px;
      color:var(--ink-soft);
      margin-bottom:4px;
    }

    .whisper-rules{
      font-size:11px;
      color:var(--ink-muted);
      list-style:none;
      padding-left:0;
      margin:0;
    }

    .whisper-rules li{
      display:flex;
      align-items:flex-start;
      gap:6px;
      margin-bottom:2px;
    }

    .whisper-rules span.bullet{
      font-size:11px;
      margin-top:1px;
    }

    .whisper-rules .warning{
      color:var(--danger);
      font-weight:600;
    }

    .whisper-chat{
      border-radius:var(--radius-md);
      border:1px solid var(--border-soft);
      background:var(--bg-deep);
      padding:8px 8px 6px;
      margin-bottom:8px;
      height:160px;
      max-height:190px;
      overflow-y:auto;
      scroll-behavior:smooth;
    }

    @media (min-width:960px){
      .whisper-chat{
        height:170px;
        max-height:200px;
      }
    }

    .whisper-chat-inner{
      display:flex;
      flex-direction:column;
      gap:6px;
      font-size:11px;
    }

    .whisper-row{
      display:flex;
      align-items:flex-start;
      gap:6px;
    }

    .whisper-left{
      flex:1;
      display:flex;
      flex-direction:column;
      gap:2px;
      min-width:0;
    }

    .bubble{
      max-width:100%;
      padding:7px 8px;
      border-radius:11px;
      line-height:1.4;
      white-space:pre-wrap;
      word-wrap:break-word;
    }

    .bubble.user{
      align-self:flex-start;
      background:#121720;
      border:1px solid rgba(255,255,255,.18);
      color:var(--ink);
    }

    .bubble-meta{
      display:flex;
      justify-content:flex-start;
      align-items:center;
      gap:4px;
      font-size:10px;
      color:var(--ink-muted);
      margin-top:2px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .whisper-delete{
      border:none;
      background:transparent;
      color:var(--ink-muted);
      font-size:11px;
      cursor:pointer;
      padding:0 2px;
      margin-top:4px;
      flex-shrink:0;
    }

    .whisper-delete:hover{
      color:var(--danger);
    }

    .whisper-empty{
      font-size:11px;
      color:var(--ink-muted);
    }

    .whisper-form{
      display:flex;
      flex-direction:column;
      gap:6px;
    }

    .whisper-label-row{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:8px;
      flex-wrap:wrap;
    }

    .whisper-label{
      font-size:12px;
      color:var(--ink-soft);
    }

    .whisper-zone-active{
      font-size:11px;
      color:var(--ink-soft2);
      display:flex;
      align-items:center;
      gap:4px;
    }

    .pill-dot{
      width:8px;
      height:8px;
      border-radius:50%;
      background:radial-gradient(circle at 30% 20%, rgba(255,255,255,.75) 0, rgba(255,255,255,.1) 60%);
      box-shadow:0 0 0 1px rgba(255,255,255,.4);
    }

    .whisper-input{
      font-family:var(--font-sans);
      font-size:12px;
      padding:8px 10px;
      border-radius:var(--radius-md);
      border:1px solid var(--border-soft);
      background:#090c11;
      color:var(--ink);
      resize:vertical;
      min-height:52px;
      max-height:120px;
    }

    .whisper-input::placeholder{
      color:var(--ink-muted);
    }

    .whisper-input:focus{
      outline:none;
      border-color:var(--border-strong);
      box-shadow:0 0 0 1px var(--border-strong);
    }

    .whisper-controls{
      display:flex;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
      gap:6px;
    }

    .whisper-actions{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      justify-content:flex-end;
    }

    .whisper-hint{
      font-size:10px;
      color:var(--ink-muted);
      margin-top:2px;
    }

    .whisper-hint .warning{
      color:var(--danger);
      font-weight:600;
    }

    .btn{
      border-radius:var(--radius-pill);
      border:1px solid rgba(255,255,255,.18);
      background:#121720;
      color:var(--ink-soft);
      font-size:12px;
      padding:7px 13px;
      display:inline-flex;
      align-items:center;
      gap:6px;
      cursor:pointer;
      box-shadow:var(--shadow-chip);
    }

    .btn.primary{
      background:#f5f5f5;
      color:#050608;
      border-color:rgba(255,255,255,.24);
      font-weight:500;
    }

    .btn:disabled{
      opacity:.6;
      cursor:default;
      box-shadow:none;
    }

    .btn-ghost{
      border-radius:var(--radius-pill);
      border:1px solid rgba(255,255,255,.2);
      background:#0b0f13;
      color:var(--ink-soft2);
      font-size:11px;
      padding:4px 9px;
      display:inline-flex;
      align-items:center;
      gap:5px;
    }

    /* Toast */

    .toast{
      position:fixed;
      left:50%;
      bottom:18px;
      transform:translateX(-50%) translateY(120%);
      background:var(--bg-deep);
      color:var(--ink-soft);
      border-radius:var(--radius-pill);
      border:1px solid rgba(255,255,255,.2);
      padding:7px 12px;
      font-size:11px;
      display:flex;
      align-items:center;
      gap:6px;
      box-shadow:0 16px 34px rgba(0,0,0,.9);
      opacity:0;
      transition:opacity .18s, transform .18s;
      z-index:50;
      max-width:90vw;
    }

    .toast.show{
      opacity:1;
      transform:translateX(-50%) translateY(0);
    }

    .toast-icon{
      font-size:13px;
    }

    .toast-text{
      white-space:normal;
    }

  </style>
</head>

<body>
<div class="shell">
  <header class="shell-header">
    <div class="brand">
      <div class="brand-logo">
        <img src="favicon.png" alt="Lumina ‚Äì guide in Arcana">
      </div>
      <div class="brand-title">
        <div class="brand-title-main">Arcana</div>
        <div class="brand-title-sub">Sensitive things, kept in safe shorthand</div>
      </div>
    </div>

    <div class="shell-nav">
      <a class="nav-link" href="lumina-demo-en.html">
        <span>üóØ</span><span>Pokec</span>
      </a>
      <a class="nav-link" href="chronica-en.html">
        <span>üìñ</span><span>Chronica</span>
      </a>
      <div id="planBadge" class="plan-badge">DEMO ¬∑ FREE plan</div>
    </div>
  </header>

  <main class="shell-main">
    <div class="halo" aria-hidden="true"></div>

    <section class="panel-main" aria-label="Arcana ‚Äì vault hall">
      <div id="lockOverlay" class="lock-overlay" hidden>
        <div class="lock-title">Arcana is locked for now</div>
        <div class="lock-text">
          You are in the FREE plan. The Arcana vault (Clavis, Pecunia, Corpus Medica, Codex Vitae)
          is only a preview in this DEMO. In the live version it would open from the
          <strong>PLUS</strong> plan and higher.
        </div>
        <div class="lock-chip">DEMO preview for FREE</div>
      </div>

      <header class="panel-header">
        <div class="panel-kicker">Vault hall</div>
        <div class="panel-title-row">
          <h1 class="panel-title">Arcana ‚Äì Vault</h1>
        </div>
        <p class="panel-lead">
          Here we sort more sensitive things into zones: Arcana Clavis (passwords),
          Arcana Pecunia (money), Corpus Medica (health), Codex Vitae (documents).
          For Chronica we only create safe shorthand ‚Äì no full numbers or diagnoses.
        </p>
        <p id="planHint" class="panel-note">
          Checking which plan you are in‚Ä¶ üíæ
        </p>
        <p class="panel-note">
          <span class="warning">IMPORTANT:</span> This vault hall is a <strong>DEMO</strong>.
          Do not enter real passwords, ID numbers, card numbers or full medical reports.
        </p>
      </header>

      <div class="content-grid">
        <!-- LEFT ‚Äì zones -->
        <section class="col-zones" aria-label="Vault zones">
          <h2 class="section-title">Vault zones</h2>
          <p class="section-sub">
            Choose roughly where what you want to track belongs.  
            In the live version these zones will behave like specialised managers.
          </p>

          <div class="zone-grid" id="zoneGrid">
            <button type="button" class="zone-card" data-zone="pecunia" data-min-plan="plus">
              <div class="zone-name-row">
                <div class="zone-name">Arcana Pecunia</div>
                <span class="zone-tag">money &amp; payments</span>
              </div>
              <div class="zone-desc">
                One-off payments, instalments, higher advances ‚Äì any money thing that should be remembered in your budget.
              </div>
              <div class="zone-foot">
                <span class="zone-dot"></span><span>Lighthouse for your budget.</span>
              </div>
            </button>

            <button type="button" class="zone-card" data-zone="medica" data-min-plan="plus">
              <div class="zone-name-row">
                <div class="zone-name">Corpus Medica</div>
                <span class="zone-tag">doctors &amp; health</span>
              </div>
              <div class="zone-desc">
                Check-ups, examinations, appointments. Chronica only gets a sentence like
                ‚Äúdentist check-up‚Äù ‚Äì not the whole report.
              </div>
              <div class="zone-foot">
                <span class="zone-dot"></span><span>Keeps health in mind without exposing details.</span>
              </div>
            </button>

            <button type="button" class="zone-card" data-zone="vitae" data-min-plan="plus">
              <div class="zone-name-row">
                <div class="zone-name">Codex Vitae</div>
                <span class="zone-tag">documents &amp; validity</span>
              </div>
              <div class="zone-desc">
                ID card, passport, driving licence, technical inspection‚Ä¶ Only reminders like
                ‚ÄúID card expires in 2 months‚Äù ‚Äì numbers stay in the vault.
              </div>
              <div class="zone-foot">
                <span class="zone-dot"></span><span>Watches expiry and renewals.</span>
              </div>
            </button>

            <button type="button" class="zone-card" data-zone="clavis" data-min-plan="premium">
              <div class="zone-name-row">
                <div class="zone-name">Arcana Clavis</div>
                <span class="zone-lock">PREMIUM zone ¬∑ passwords</span>
              </div>
              <div class="zone-desc">
                Manager for passwords, PINs and access. In the DEMO it‚Äôs only a preview.
                The live version would have to encrypt and never send passwords outside the vault.
              </div>
              <div class="zone-foot">
                <span class="zone-dot"></span><span>Only a preview here in the demo.</span>
              </div>
            </button>
          </div>
        </section>

        <!-- RIGHT ‚Äì Whisper room -->
        <section class="col-whisper" aria-label="Whisper room ‚Äì sorting chat">
          <div class="whisper-header">
            <div class="whisper-avatar-wrap">
              <img src="avatar.png" alt="Lumina ‚Äì guardian of the vault">
            </div>
            <div>
              <div class="whisper-title">Whisper room</div>
              <div class="whisper-lead">
                Here you can write sentences you don‚Äôt want to put into regular Pokec.
                In this DEMO I will turn them into a shortened note for Chronica.
              </div>
              <ul class="whisper-rules">
                <li><span class="bullet">‚Ä¢</span><span class="warning">This version is a DEMO ‚Äì please do not enter real passwords, ID numbers, card numbers or full medical reports.</span></li>
                <li><span class="bullet">‚Ä¢</span><span>The Whisper room in the DEMO stores entries only <strong>locally in your browser</strong>.</span></li>
                <li><span class="bullet">‚Ä¢</span><span>In the live version sensitive data would be encrypted and designed in line with personal data protection rules.</span></li>
              </ul>
            </div>
          </div>

          <div class="whisper-chat" aria-live="polite">
            <div id="whisperChatInner" class="whisper-chat-inner"></div>
          </div>

          <form id="whisperForm" class="whisper-form">
            <div class="whisper-label-row">
              <label class="whisper-label" for="whisperInput">
                What do you want me to keep an eye on in Arcana?
              </label>
              <div class="whisper-zone-active">
                <span class="pill-dot"></span>
                <span id="activeZoneLabel">Zone: automatic based on text</span>
              </div>
            </div>

            <textarea
              id="whisperInput"
              class="whisper-input"
              placeholder="For example: ‚Äúdentist check-up in May‚Äù, ‚Äúnext month higher electricity advance‚Äù, ‚ÄúID card expires at the end of the year‚Äù"></textarea>

            <div class="whisper-controls">
              <button type="button" class="btn-ghost" id="btnZoneAuto">
                üîÑ Let the zone be chosen automatically
              </button>
              <div class="whisper-actions">
                <button type="button" class="btn" id="btnArcanaOnly">
                  üïØ Only in Arcana
                </button>
                <button type="button" class="btn primary" id="btnChronica">
                  üíæ Arcana + Chronica
                </button>
              </div>
            </div>

            <p class="whisper-hint">
              <span class="warning">DEMO:</span> Entries are stored only as shortened sentences in your browser.
              We send only safe summaries to Chronica ‚Äì without passwords, card numbers or diagnoses.
            </p>
          </form>
        </section>
      </div>
    </section>
  </main>
</div>

<div id="toast" class="toast" role="status" aria-live="polite">
  <span id="toastIcon" class="toast-icon">üí¨</span>
  <span id="toastText" class="toast-text"></span>
</div>

<script>
(function(){
  const PLAN_RANK    = { free: 0, plus: 1, premium: 2 };
  const STATE_KEY    = "ARCANA_HALA_DEMO_STATE_V3";
  const CHRONICA_KEY = "chronica";

  function normalizePlan(p){
    if(!p) return "free";
    p = String(p).toLowerCase();
    return (p === "free" || p === "plus" || p === "premium") ? p : "free";
  }

  function readStoredPlan(){
    try{
      const fromKey = localStorage.getItem("lm_plan");
      if(fromKey) return normalizePlan(fromKey);

      const rawUser = localStorage.getItem("miniLuminaUser");
      if(rawUser){
        const user = JSON.parse(rawUser);
        if(user && user.plan) return normalizePlan(user.plan);
      }
    }catch(e){}
    return "free";
  }

  const planBadge   = document.getElementById("planBadge");
  const planHint    = document.getElementById("planHint");
  const lockOverlay = document.getElementById("lockOverlay");

  const zoneGrid  = document.getElementById("zoneGrid");
  const zoneCards = zoneGrid ? Array.from(zoneGrid.querySelectorAll(".zone-card")) : [];

  const activeZoneLabel = document.getElementById("activeZoneLabel");
  const btnZoneAuto     = document.getElementById("btnZoneAuto");

  const whisperForm      = document.getElementById("whisperForm");
  const whisperInput     = document.getElementById("whisperInput");
  const whisperChatInner = document.getElementById("whisperChatInner");
  const btnArcanaOnly    = document.getElementById("btnArcanaOnly");
  const btnChronica      = document.getElementById("btnChronica");

  const toast     = document.getElementById("toast");
  const toastIcon = document.getElementById("toastIcon");
  const toastText = document.getElementById("toastText");

  let plan       = readStoredPlan();
  let state      = loadState();
  let activeZone = state.activeZone || "auto";

  function loadState(){
    try{
      const raw = localStorage.getItem(STATE_KEY);
      if(!raw) return { activeZone:"auto", whispers:[] };
      const parsed = JSON.parse(raw);
      if(!parsed || typeof parsed !== "object") return { activeZone:"auto", whispers:[] };
      if(!Array.isArray(parsed.whispers)) parsed.whispers = [];
      if(!parsed.activeZone) parsed.activeZone = "auto";
      return parsed;
    }catch(e){
      return { activeZone:"auto", whispers:[] };
    }
  }

  function saveState(){
    try{
      localStorage.setItem(STATE_KEY, JSON.stringify(state));
    }catch(e){}
  }

  function showToast(pill, msg, ms){
    if(!toast) return;
    const dur = (typeof ms === "number" && ms > 0) ? ms : 6500;
    if(toastIcon) toastIcon.textContent = pill || "DEMO";
    if(toastText) toastText.textContent = msg || "";
    toast.classList.add("show");
    clearTimeout(window.__arcanaHalaToastT);
    window.__arcanaHalaToastT = setTimeout(()=>{
      toast.classList.remove("show");
    }, dur);
  }

  function labelForPlan(p){
    if(p === "plus") return "DEMO ¬∑ PLUS plan";
    if(p === "premium") return "DEMO ¬∑ PREMIUM plan";
    return "DEMO ¬∑ FREE plan";
  }

  function initPlanUI(){
    if(!planBadge || !planHint || !lockOverlay) return;

    planBadge.textContent = labelForPlan(plan);

    let hint = "";

    if(plan === "free"){
      hint = "FREE demo: the hall is only a light preview. Zones behave symbolically, nothing is fully connected.";
      lockOverlay.removeAttribute("hidden");
    }else if(plan === "plus"){
      hint = "PLUS demo: Pecunia / Corpus Medica / Codex Vitae react to whispers. Arcana Clavis stays locked.";
      lockOverlay.setAttribute("hidden","true");
    }else{
      hint = "PREMIUM demo: all four zones behave like a living vault. Data stays only locally in this browser.";
      lockOverlay.setAttribute("hidden","true");
    }

    planHint.textContent = hint;
  }

  function findZoneName(id){
    if(id === "pecunia") return "Arcana Pecunia ‚Ä¢ money";
    if(id === "medica")  return "Corpus Medica ‚Ä¢ health";
    if(id === "vitae")   return "Codex Vitae ‚Ä¢ documents";
    if(id === "clavis")  return "Arcana Clavis ‚Ä¢ passwords";
    return "";
  }

  function updateZoneLabel(){
    if(!activeZoneLabel) return;
    if(activeZone === "auto"){
      activeZoneLabel.textContent = "Zone: automatic based on text";
    }else{
      const name = findZoneName(activeZone) || activeZone.toUpperCase();
      activeZoneLabel.textContent = "Zone: " + name;
    }
  }

  function flashZone(zoneId){
    if(!zoneGrid) return;
    const card = zoneCards.find(c => c.dataset.zone === zoneId);
    if(!card) return;
    card.classList.add("zone-pulse");
    setTimeout(()=> card.classList.remove("zone-pulse"), 700);
  }

  function setActiveZone(zoneId, fromUser){
    activeZone = zoneId;
    state.activeZone = zoneId;
    saveState();

    if(zoneGrid){
      zoneCards.forEach(card=>{
        const z = card.dataset.zone;
        card.classList.toggle("is-active", z === zoneId);
      });
    }

    updateZoneLabel();

    if(fromUser){
      if(zoneId === "auto"){
        showToast("ARCANA","I‚Äôll choose the zone automatically based on the text.",4200);
      }else{
        showToast("ARCANA","Whispers now go mainly to: " + (findZoneName(zoneId) || zoneId.toUpperCase()),4200);
      }
    }
  }

  function initZones(){
    if(!zoneGrid) return;

    zoneCards.forEach(card=>{
      const zoneId = card.dataset.zone;
      const minPlan = normalizePlan(card.dataset.minPlan || "free");

      card.addEventListener("click", ()=>{
        const rank = PLAN_RANK[plan] ?? 0;
        const need = PLAN_RANK[minPlan] ?? 0;

        if(zoneId === "clavis" && plan !== "premium"){
          showToast("üîí","Arcana Clavis is available only in the PREMIUM plan in the live version. Here it‚Äôs just a light preview.",5200);
          return;
        }

        if(rank < need){
          showToast("ARCANA","In the live version this zone would belong to a higher plan. In the demo I only show it as a preview.",5200);
          return;
        }

        setActiveZone(zoneId, true);
      });
    });

    if(btnZoneAuto){
      btnZoneAuto.addEventListener("click", ()=>{
        if(plan === "free"){
          showToast("ARCANA","In the FREE demo we only show a simple preview. In PLUS/PREMIUM a full automatic mode would be available.",5200);
          return;
        }
        setActiveZone("auto", true);
      });
    }

    if(plan === "free"){
      setActiveZone("auto", false);
    }else{
      setActiveZone(activeZone || "auto", false);
    }
  }

  // --- zone detection from text (EN) ---

  function getZoneForText(text){
    const t = (text || "").toLowerCase();
    if(!t.trim()) return "auto";

    // passwords / access
    if(/\b(password|passcode|login|log[- ]?in|pin|puk|2fa|two[- ]factor|verification code|security code)\b/.test(t)){
      return "clavis";
    }

    // money
    if(/\b(loan|credit|mortgage|instalment|installment|rent|rent payment|bill|invoice|insurance|premium|salary|paycheck|wage|income|tax|taxes|energy|electricity|power bill|gas bill|gas|internet|standing order|direct debit|payment|repayment|due date)\b/.test(t)){
      return "pecunia";
    }

    // health
    if(/\b(dentist|dental|doctor|gp|general practitioner|gynecolog|gynaecolog|psychiatrist|psychologist|therapy|therapist|check[- ]?up|examination|scan|ultrasound|x[- ]?ray|mri|clinic|rehab|rehabilitation|physio|pharmacy|medicine|medication|vaccine|vaccination)\b/.test(t)){
      return "medica";
    }

    // documents
    if(/\b(id card|identity card|passport|driving licence|driving license|driver'?s license|license|licence|document|documents|residence permit|residence card|registration|technical inspection|inspection|mot|number plate|plate|visa)\b/.test(t)){
      return "vitae";
    }

    return "vitae";
  }

  function extractDateFragment(text){
    if(!text) return "";
    const dateRegex = /(\d{1,2}\.\s*\d{1,2}\.\s*\d{2,4}|\d{1,2}\.\s*\d{1,2}\.)/;
    const monthRegex = /\b(january|february|march|april|may|june|july|august|september|october|november|december)\b/i;

    const m1 = text.match(dateRegex);
    if(m1) return m1[0].trim();

    const m2 = text.match(monthRegex);
    if(m2) return m2[0].trim();

    return "";
  }

  function getEffectiveZone(text){
    if(activeZone && activeZone !== "auto") return activeZone;
    return getZoneForText(text);
  }

  // --- sanitisation for Chronica (EN) ---

  function sanitizeForChronica(zoneId, text){
    const original = text || "";
    const datePart = extractDateFragment(original);

    if(zoneId === "pecunia"){
      let base = "Money ‚Äì reminder without account or card numbers";
      if(datePart){
        return base + " ‚Äì remind around " + datePart;
      }
      return base;
    }

    if(zoneId === "medica"){
      let base = "Health appointment ‚Äì without diagnosis or detailed report";
      if(datePart){
        return base + " (" + datePart + ")";
      }
      return base;
    }

    if(zoneId === "vitae"){
      let base = "Documents ‚Äì validity without document number, address or personal ID number";
      if(datePart){
        return base + " (around " + datePart + ")";
      }
      return base;
    }

    let base = "Reminder from Arcana vault ‚Äì safe summary without sensitive details";
    if(datePart){
      return base + " (" + datePart + ")";
    }
    return base;
  }

  function pushToChronica(zoneId, text){
    if(zoneId === "clavis" || zoneId === "auto") return;

    const title = sanitizeForChronica(zoneId, text || "");
    if(!title) return;

    let tag;
    if(zoneId === "pecunia") tag = "money";
    else if(zoneId === "medica") tag = "health";
    else if(zoneId === "vitae") tag = "documents";
    else tag = "note";

    try{
      const raw = localStorage.getItem(CHRONICA_KEY);
      const arr = raw ? JSON.parse(raw) : [];
      const now = new Date();

      arr.unshift({
        id: "arcana-" + now.getTime(),
        title,
        tag,
        mood: "",
        done: false,
        createdAt: now.toISOString()
      });

      localStorage.setItem(CHRONICA_KEY, JSON.stringify(arr));
    }catch(e){}
  }

  function getEmptyWhisperText(){
    if(whisperChatInner && whisperChatInner.dataset && whisperChatInner.dataset.emptyText){
      return whisperChatInner.dataset.emptyText;
    }
    return "You haven‚Äôt whispered anything yet. You can write a small worry here that you don‚Äôt want to carry only in your head.";
  }

  function removeWhisper(id){
    state.whispers = state.whispers.filter(entry => entry.id !== id);
    saveState();
    renderWhispers();
    showToast("ARCANA","The whisper has been deleted only from this browser.",3600);
  }

  function renderWhispers(){
    if(!whisperChatInner) return;
    whisperChatInner.innerHTML = "";

    if(!state.whispers.length){
      const empty = document.createElement("p");
      empty.className = "whisper-empty";
      empty.textContent = getEmptyWhisperText();
      whisperChatInner.appendChild(empty);
      return;
    }

    const slice = state.whispers.slice(-12);
    slice.forEach(entry=>{
      const row = document.createElement("div");
      row.className = "whisper-row";

      const left = document.createElement("div");
      left.className = "whisper-left";

      const bubble = document.createElement("div");
      bubble.className = "bubble user";
      bubble.textContent = entry.text;

      const meta = document.createElement("div");
      meta.className = "bubble-meta";
      const label = document.createElement("span");
      const zonePart = entry.zone && entry.zone !== "auto"
        ? " ¬∑ " + (findZoneName(entry.zone) || entry.zone.toUpperCase())
        : "";
      label.textContent = (entry.when || "") + zonePart;
      meta.appendChild(label);

      left.appendChild(bubble);
      left.appendChild(meta);

      const del = document.createElement("button");
      del.type = "button";
      del.className = "whisper-delete";
      del.textContent = "‚úï";
      del.addEventListener("click", ()=> removeWhisper(entry.id));

      row.appendChild(left);
      row.appendChild(del);
      whisperChatInner.appendChild(row);
    });

    whisperChatInner.scrollTop = whisperChatInner.scrollHeight;
  }

  function handleWhisper(toChronica){
    if(!whisperInput) return;
    const text = whisperInput.value.trim();
    if(!text) return;

    const zoneId = getEffectiveZone(text);
    const now = new Date();
    const when = now.toLocaleString("en-GB", {
      day:"2-digit", month:"2-digit", year:"numeric",
      hour:"2-digit", minute:"2-digit"
    });

    state.whispers.push({
      id: now.getTime(),
      text,
      zone: zoneId,
      when
    });
    if(state.whispers.length > 120){
      state.whispers = state.whispers.slice(-120);
    }
    saveState();
    renderWhispers();

    if(zoneId !== "auto"){
      flashZone(zoneId);
    }

    if(toChronica){
      if(zoneId === "clavis"){
        showToast(
          "üîí",
          "This looks like a password or access data. I won‚Äôt store it in Chronica ‚Äì it stays only in Arcana.",
          8000
        );
      }else{
        pushToChronica(zoneId, text);

        let msg;
        if(zoneId === "pecunia"){
          msg = "Saved to Chronica as a money reminder ‚Äì without account or card numbers.";
        }else if(zoneId === "medica"){
          msg = "Saved to Chronica as a health appointment ‚Äì without diagnosis or full medical report.";
        }else if(zoneId === "vitae"){
          msg = "Saved to Chronica as a document reminder ‚Äì without document number, address or personal ID.";
        }else{
          msg = "Saved to the vault and to Chronica as a safe summary without sensitive details.";
        }

        showToast("üíæ", msg, 7500);
      }
    }else{
      showToast("ARCANA","Saved only inside Arcana. Nothing is sent to Chronica.",6500);
    }

    whisperInput.value = "";
  }

  function initWhisper(){
    if(!whisperForm || !whisperInput) return;

    if(btnArcanaOnly){
      btnArcanaOnly.addEventListener("click", ()=>{
        handleWhisper(false);
      });
    }

    if(btnChronica){
      btnChronica.addEventListener("click", ()=>{
        handleWhisper(true);
      });
    }

    whisperForm.addEventListener("submit", (ev)=>{
      ev.preventDefault();
      if(btnChronica){
        btnChronica.click();
      }else{
        handleWhisper(true);
      }
    });

    renderWhispers();
  }

  document.addEventListener("DOMContentLoaded", function(){
    initPlanUI();
    initZones();
    initWhisper();
  });
})();
</script>
</body>
</html>