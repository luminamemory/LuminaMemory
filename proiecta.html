<!doctype html>
<html lang="cs">
<head>

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noindex,nofollow">

  <style>
    :root{
  --bg0:#020814;
  --bg1:#03161d;

  --glass: rgba(255,255,255,.06);
  --line: rgba(255,255,255,.10);
  --line2: rgba(255,255,255,.14);
  --ink:#EAF7F6;
  --muted: rgba(234,247,246,.72);

  --accent:#24D2C1;
  --accent2:#7CE7FF;

  --shadow: 0 18px 60px rgba(0,0,0,.45);
  --shadow2: 0 10px 26px rgba(0,0,0,.34);

  --radius: 22px;
  --max: 1180px;

  /* üé® Proiecta ‚Äì barvy skvrn */
  --paintY: rgba(255, 214, 74, .45);   /* ≈ælut√° */
  --paintP: rgba(255,  86, 176, .36);  /* r≈Ø≈æov√° */
  --paintV: rgba(160,  90, 255, .34);  /* fialov√° */
  --paintB: rgba( 86, 166, 255, .32);  /* modr√° */
  --paintG: rgba( 72, 220, 150, .30);  /* zelen√° */
}

body{
  margin:0;
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji","Segoe UI Emoji";
  color: var(--ink);

  /* z√°klad z≈Øst√°v√° tmav√Ω, aby glass design byl ƒçiteln√Ω */
  background:
    radial-gradient(1200px 700px at 15% -10%, rgba(36,210,193,.14), transparent 58%),
    radial-gradient(900px 650px at 85% 0%, rgba(124,231,255,.10), transparent 55%),
    radial-gradient(1200px 820px at 50% 120%, rgba(0,0,0,.78), transparent 65%),
    linear-gradient(180deg, var(--bg0) 0%, var(--bg1) 100%);
  background-attachment: fixed;
  overflow-x:hidden;
}

/* üé® Skvrny + odkap√°v√°n√≠ barvy */
body::before{
  content:"";
  position:fixed;
  inset:-80px -60px -140px -60px;
  pointer-events:none;
  z-index:0;

  background:
    /* velk√© skvrny */
    radial-gradient(280px 220px at 12% 18%, var(--paintY), transparent 70%),
    radial-gradient(320px 240px at 72% 10%, var(--paintP), transparent 72%),
    radial-gradient(360px 280px at 92% 34%, var(--paintV), transparent 74%),
    radial-gradient(340px 260px at 18% 72%, var(--paintB), transparent 74%),
    radial-gradient(420px 320px at 78% 78%, var(--paintG), transparent 76%),

    /* men≈°√≠ c√°kance */
    radial-gradient(120px 100px at 26% 36%, rgba(255,214,74,.22), transparent 70%),
    radial-gradient(140px 120px at 64% 44%, rgba(160,90,255,.18), transparent 70%),
    radial-gradient(130px 110px at 86% 66%, rgba(86,166,255,.16), transparent 70%),
    radial-gradient(150px 120px at 42% 82%, rgba(255,86,176,.16), transparent 70%),

    /* horn√≠ ‚Äúp√°s barvy‚Äù */
    linear-gradient(to bottom,
      rgba(255,255,255,0) 0px,
      rgba(255,255,255,0) 8px,
      rgba(255,214,74,.12) 30px,
      rgba(255,86,176,.10) 70px,
      rgba(160,90,255,.10) 120px,
      rgba(86,166,255,.08) 170px,
      rgba(72,220,150,.08) 220px,
      rgba(0,0,0,0) 280px
    ),

    /* odkap√°v√°n√≠ (svisl√© pruhy jen naho≈ôe) */
    repeating-linear-gradient(90deg,
      rgba(0,0,0,0) 0 14px,
      rgba(255,214,74,.14) 14px 18px,
      rgba(0,0,0,0) 18px 30px,
      rgba(255,86,176,.12) 30px 34px,
      rgba(0,0,0,0) 34px 52px,
      rgba(160,90,255,.12) 52px 56px,
      rgba(0,0,0,0) 56px 78px,
      rgba(86,166,255,.10) 78px 82px,
      rgba(0,0,0,0) 82px 108px,
      rgba(72,220,150,.10) 108px 112px,
      rgba(0,0,0,0) 112px 140px
    );

  /* ka≈æd√° vrstva jinak */
  background-repeat:
    no-repeat, no-repeat, no-repeat, no-repeat, no-repeat,
    no-repeat, no-repeat, no-repeat, no-repeat,
    no-repeat,
    repeat-x;

  /* posledn√≠ 2 vrstvy jen naho≈ôe, skvrny p≈ôes pl√°tno */
  background-size:
    auto, auto, auto, auto, auto,
    auto, auto, auto, auto,
    100% 320px,
    100% 260px;

  background-position:
    0 0, 0 0, 0 0, 0 0, 0 0,
    0 0, 0 0, 0 0, 0 0,
    0 0,
    0 0;

  /* aby to bylo ‚Äúmal√≠≈ôsk√©‚Äù a ne k≈ôiklav√© */
  opacity:.78;
  filter: saturate(1.08) contrast(1.05) blur(.15px);
  mix-blend-mode: screen;
}

/* üß± Praskliny / roztr≈æen√≠ + jemn√Ω lesk (ponech√°v√° ƒçitelnost) */
body::after{
  content:"";
  position:fixed;
  inset:-40px;
  pointer-events:none;
  z-index:0;

  background:
    /* jemn√Ω lesk jako p≈ôedt√≠m */
    radial-gradient(1200px 700px at 30% 30%, rgba(255,255,255,.10), rgba(255,255,255,0) 60%),

    /* praskliny */
    repeating-linear-gradient(135deg,
      rgba(255,255,255,0) 0 22px,
      rgba(255,255,255,.06) 22px 23px,
      rgba(0,0,0,0) 23px 64px
    ),
    repeating-linear-gradient(42deg,
      rgba(0,0,0,0) 0 28px,
      rgba(0,0,0,.22) 28px 29px,
      rgba(0,0,0,0) 29px 80px
    ),

    /* ‚Äúroztr≈æen√©‚Äù okraje v roz√≠ch */
    conic-gradient(from 210deg at 0% 0%,
      rgba(0,0,0,.55), rgba(0,0,0,0) 22%, rgba(0,0,0,0) 100%
    ),
    conic-gradient(from -30deg at 100% 0%,
      rgba(0,0,0,.50), rgba(0,0,0,0) 20%, rgba(0,0,0,0) 100%
    );

  mix-blend-mode: overlay;
  opacity:.22;
}

    .wrap{
      max-width: var(--max);
      margin: 0 auto;
      padding: 22px 18px 40px;
      position:relative;
      z-index:1;
    }

    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:14px;
      margin-bottom: 14px;
    }

    .brand{
      display:flex; align-items:center; gap:12px;
      min-width: 240px;
    }
    .brand .t{ display:flex; flex-direction:column; line-height:1.08; }
    .brand .t strong{ font-size:16px; letter-spacing:.2px; }
    .brand .t span{ font-size:12.5px; color: var(--muted); }

    nav{
      display:flex; gap:10px; flex-wrap:wrap;
      justify-content:flex-end;
      align-items:center;
    }

    .navbtn, .btn{
      display:inline-flex; align-items:center; gap:8px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.06);
      color: var(--ink);
      text-decoration:none;
      box-shadow: 0 8px 22px rgba(0,0,0,.22);
      backdrop-filter: blur(12px);
      cursor:pointer;
      font-weight: 780;
      letter-spacing:.1px;
      white-space:nowrap;
      user-select:none;
    }
    .navbtn:hover, .btn:hover{ transform: translateY(-1px); }
    .btn.primary{
      border-color: rgba(36,210,193,.45);
      background: rgba(36,210,193,.10);
    }
    .btn.ghost{ opacity:.92; }
    .btn:disabled{ opacity:.55; cursor:not-allowed; transform:none; }

    .hero{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:14px;
      margin: 10px 0 16px;
      padding: 18px 18px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.06);
      border-radius: var(--radius);
      box-shadow: var(--shadow2);
      backdrop-filter: blur(14px);
    }
    .hero h1{
      margin:0;
      font-size: 18px;
      letter-spacing:.2px;
    }
    .hero p{
      margin:6px 0 0;
      color: var(--muted);
      font-size: 13.5px;
      max-width: 76ch;
    }

    .pillrow{ display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end; align-items:center; }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding: 9px 11px;
      border-radius: 999px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.06);
      color: var(--muted);
      font-size: 12.5px;
      font-weight: 720;
      backdrop-filter: blur(12px);
    }
    .pill b{ color: var(--ink); font-weight:860; }
    .dot{
      width:9px; height:9px; border-radius:99px;
      background: var(--accent);
      box-shadow: 0 0 0 6px rgba(36,210,193,.12);
    }
    .seg{
      display:inline-flex;
      border:1px solid var(--line);
      border-radius:999px;
      overflow:hidden;
      background: rgba(255,255,255,.05);
    }
    .seg button{
      border:0;
      background:transparent;
      color: var(--muted);
      font-weight:850;
      padding: 8px 10px;
      cursor:pointer;
    }
    .seg button.active{
      color: var(--ink);
      background: rgba(36,210,193,.12);
    }

    .card{
      border:1px solid var(--line);
      background: rgba(255,255,255,.06);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(14px);
      overflow:hidden;
    }
    .hd{
      display:flex; align-items:center; justify-content:space-between;
      gap: 10px;
      padding: 14px 16px;
      border-bottom:1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.05);
    }
    .title{ display:flex; flex-direction:column; gap:2px; }
    .title strong{ font-size: 13.5px; }
    .title span{ font-size: 12px; color: var(--muted); }
    .actions{ display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end; }

    .studio{
  height: min(90vh, 880px);
  display:flex;
  flex-direction:column;
  gap: 12px;
  min-height:0;
  padding: 14px 16px 16px;
}

    .chatlog{
      flex: 1 1 auto;
      min-height:0;
      overflow:auto;
      padding: 12px 12px 6px;
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 16px;
      background: rgba(0,0,0,.12);
      scrollbar-gutter: stable both-edges;
    }

    .msg{
      display:flex;
      gap:10px;
      margin: 10px 0;
      align-items:flex-start;
    }
    .avatar{
      width:34px; height:34px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      display:grid;
      place-items:center;
      overflow:hidden;
      flex: 0 0 auto;
      box-shadow: 0 10px 24px rgba(0,0,0,.22);
    }
    .avatar img{ width:100%; height:100%; object-fit:cover; display:block; }
    .avatar .letter{ font-weight:900; font-size: 14px; color: var(--ink); }

    .bubble{
      max-width: 78%;
      padding: 10px 12px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.07);
      box-shadow: 0 8px 22px rgba(0,0,0,.20);
    }
    .bubble.user{
      background: rgba(36,210,193,.09);
      border-color: rgba(36,210,193,.20);
    }
    .bubble p{ margin:0; font-size: 13.5px; line-height:1.45; color: var(--ink); }
    .meta{
      margin-top:7px;
      font-size: 11px;
      color: rgba(234,247,246,.70);
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
    }
    .tag{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(124,231,255,.10);
      border: 1px solid rgba(124,231,255,.16);
      color: rgba(234,247,246,.92);
      font-weight: 780;
    }

    .thumbRow{
      margin-top:10px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }
    .thumbMini{
      width: 140px;
      border-radius: 14px;
      overflow:hidden;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      cursor: pointer;
    }
    .thumbMini img{
      display:block;
      width:100%;
      height:auto;
    }
    .fileChip{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 8px 10px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.16);
      color: var(--ink);
      text-decoration:none;
      font-weight: 780;
      font-size: 12.5px;
    }
    .fileChip small{ color: var(--muted); font-weight:700; }

    .composer{
      display:flex;
      gap:10px;
      align-items:stretch;
    }
    .composer input[type="text"]{
      flex:1;
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.16);
      outline:none;
      font-size: 14px;
      color: var(--ink);
    }
    .composer input[type="text"]::placeholder{ color: rgba(234,247,246,.60); }
    .composer input[type="text"]:focus{ box-shadow: 0 0 0 5px rgba(36,210,193,.16); }

    .toolrow{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      align-items:center;
      margin-top: 8px;
    }
    .toolhint{
      font-size: 12px;
      color: var(--muted);
      margin-top: 8px;
      line-height:1.35;
    }
    .toolsection{
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px solid rgba(255,255,255,.08);
    }

    /* Odkl√°dac√≠ st≈Øl */
    .shelf{
      flex: 0 0 clamp(190px, 30%, 290px);
      min-height: 190px;
      display:flex;
      flex-direction:column;
      gap:10px;
      margin-top: 10px;
      padding-top: 6px;
      border-top: 1px solid rgba(255,255,255,.08);
    }
    .shelfLabel{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      font-size: 12px;
      color: var(--muted);
      font-weight: 860;
    }
    .shelfWrap{
      flex:1 1 auto;
      min-height:0;
      overflow:auto;
      scrollbar-gutter: stable both-edges;
      padding-right: 2px;
    }
    .feed{
      display:grid;
      gap:10px;
    }

    .shelfFilters{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      align-items:center;
      margin: 6px 0 6px;
      font-size: 12px;
    }
    .chipRow{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
    }
    .chip{
      border-radius:999px;
      border:1px solid var(--line);
      padding:4px 9px;
      background: rgba(255,255,255,.03);
      color: var(--muted);
      font-size:11.5px;
      cursor:pointer;
      font-weight:780;
    }
    .chip.is-active{
      background: rgba(36,210,193,.14);
      border-color: rgba(36,210,193,.55);
      color: var(--ink);
    }

    .item{
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.12);
      border-radius: 16px;
      padding: 12px 12px;
      box-shadow: 0 10px 24px rgba(0,0,0,.22);
    }
    .item .top{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
      margin-bottom: 8px;
    }
    .badge{
      font-size: 11px;
      font-weight: 900;
      padding: 5px 9px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      white-space:nowrap;
      color: var(--ink);
    }
    .itTitle{
      min-width:0;
      margin-left: 8px;
      flex:1;
    }
    .itTitle strong{
      display:block;
      font-size: 13px;
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
    }
    .itTitle span{
      display:block;
      font-size: 11.5px;
      color: var(--muted);
      margin-top: 2px;
    }
    .itemTopic{
      margin-top:3px;
      font-size:11px;
      color: var(--muted);
    }
    .item .body{
      font-size: 13px;
      line-height: 1.45;
      color: var(--ink);
      white-space: pre-wrap;
      word-break: break-word;
    }
    .itemActions{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .linkbtn{
      padding: 7px 10px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      cursor:pointer;
      font-weight: 850;
      font-size: 12px;
      color: var(--ink);
    }
    .linkbtn:hover{ transform: translateY(-1px); }
    .linkbtn.danger{ border-color: rgba(239,68,68,.30); background: rgba(239,68,68,.10); }
    .linkbtn.ghost{ opacity:.92; }

    .empty{
      color: var(--muted);
      font-size: 13px;
      text-align:center;
      padding: 14px 0 6px;
      line-height:1.45;
    }

    footer{
      margin-top: 14px;
      display:flex;
      justify-content:space-between;
      gap: 10px;
      flex-wrap:wrap;
      color: rgba(234,247,246,.60);
      font-size: 12px;
      padding: 0 4px;
    }

/* Kartiƒçky na odkl√°dac√≠m stole ‚Äì mobiln√≠ √∫pravy */
@media (max-width: 480px) {
  /* horn√≠ ≈ô√°dek kartiƒçky: badge + title + tlaƒç√≠tka */
  .item .top{
    flex-direction: column;      /* m√≠sto vedle sebe pod sebe */
    align-items: stretch;
    gap: 6px;
    margin-bottom: 8px;          /* v√≠c m√≠sta nad textem pozn√°mky */
  }

  .itemActions{
    justify-content: flex-start; /* tlaƒç√≠tka doleva, ne natlaƒçen√° vpravo */
    row-gap: 4px;
  }
}

    /* Modals (Lumina style) */
    .modalOverlay{
      position:fixed;
      inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      padding: 18px;
      background: rgba(0,0,0,.62);
      backdrop-filter: blur(12px);
      z-index: 9999;
    }
    .modalOverlay.show{ display:flex; }

    .modal{
      width: min(760px, 100%);
      border-radius: 20px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(6,34,37,.92);
      box-shadow: 0 30px 90px rgba(0,0,0,.55);
      overflow:hidden;
    }
    .modalHd{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 10px;
      padding: 14px 16px;
      border-bottom:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
    }
    .modalHd strong{ font-size: 14px; }
    .modalHd span{ display:block; color: var(--muted); font-size: 12.5px; margin-top: 4px; line-height:1.35; }
    .modalBd{ padding: 14px 16px 16px; }
    .modalBd p{ margin: 0 0 10px; color: var(--ink); font-size: 13.5px; line-height: 1.5; }
    .modalBtns{
      display:flex;
      gap: 10px;
      flex-wrap:wrap;
      justify-content:flex-end;
      margin-top: 12px;
    }
    .xBtn{
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      border-radius: 12px;
      padding: 8px 10px;
      cursor:pointer;
      font-weight: 900;
      color: var(--ink);
    }

    .imgFrame{
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      max-height: min(70vh, 680px);
      overflow:auto;
      margin-top: 10px;
    }
    .imgFrame img{
      width:100%;
      height:auto;
      display:block;
      cursor: zoom-out;
    }

    textarea{
      width:100%;
      min-height: 120px;
      resize: vertical;
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.16);
      outline:none;
      font-size: 13.5px;
      line-height: 1.5;
      color: var(--ink);
    }
    textarea::placeholder{ color: rgba(234,247,246,.58); }
    textarea:focus{ box-shadow: 0 0 0 5px rgba(36,210,193,.16); }

    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      align-items:start;
    }
    @media (max-width: 980px){
      .bubble{ max-width: 92%; }
      .hero{ align-items:flex-start; flex-direction:column; }
      .pillrow{ justify-content:flex-start; }
      .grid2{ grid-template-columns: 1fr; }
    }

    /* iPhone landscape ‚Äì v√≠c prostoru pro chat */
@media (max-height: 600px) {
  .studio{
    height: auto;       /* ≈æ√°dn√° pevn√° v√Ω≈°ka */
    max-height: none;   /* a ani strop */
  }

  /* m≈Ø≈æe≈° si pohr√°t ‚Äì jen jemn√© zmen≈°en√≠ stolu */
  .shelfWrap{
    margin-top: 10px;
  }

  .feed{
    max-height: 200px;  /* men≈°√≠ st≈Øl, v√≠c m√≠sta na chat */
  }
}
    /* √özk√© displeje ‚Äì cca mobil na v√Ω≈°ku */
@media (max-width: 600px) {

  .wrap{
    padding: 16px 12px 28px;
  }

  header{
    flex-direction: column;
    align-items: flex-start;
    gap: 10px;
  }

  nav{
    width: 100%;
    justify-content: flex-start;
    flex-wrap: wrap;
    gap: 6px;
  }

  .navbtn,
  .btn{
    padding: 9px 10px;
    font-size: 13px;
  }

  .hero{
    padding: 14px 14px;
    margin: 8px 0 14px;
    flex-direction: column;
    align-items: flex-start;
    gap: 10px;
  }

  .hero h1{
    font-size: 16px;
  }

  .hero p{
    font-size: 13px;
  }

  .studio{
    padding: 12px 12px 14px;
  }

  /* Composer pod sebe, a≈• se na mobilu nemaƒçk√° */
  .composer{
    flex-direction: column;
    align-items: stretch;
  }

  .composer input[type="text"]{
    width: 100%;
  }

  .composer .btn{
    width: 100%;
    justify-content: center;
  }

  /* N√°stroje ‚Äì tlaƒç√≠tka se skl√°daj√≠ do dvou sloupc≈Ø */
  .toolrow{
    gap: 6px;
  }

  .toolrow .btn{
    flex: 1 1 calc(50% - 6px);
    justify-content: flex-start;
  }

  /* Bubliny m≈Ø≈æou klidnƒõ vyu≈æ√≠t celou ≈°√≠≈ôku */
  .bubble{
    max-width: 100%;
  }
}
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div class="brand" aria-label="Proiecta">
        <div class="t">
          <strong>Proiecta</strong>
          <span>Kreativn√≠ studio Luminy ‚ú®</span>
        </div>
      </div>

      <nav aria-label="Navigace">
        <a class="navbtn" href="praetorium.html" title="Zpƒõt">‚¨ÖÔ∏è Zpƒõt</a>
        <a class="navbtn" href="lumina-demo.html" title="Pokec">üóØ Pokec</a>
        <a class="navbtn" href="proiecta-projekty.html" title="Projektov√° m√≠stnost">üì∫ Projekty</a>
      </nav>
    </header>

    <section class="hero">
      <div>
        <h1>Proiecta ‚Äî p≈ôehledn√° tvorba. üõ°Ô∏è‚ú®</h1>
        <p>
          Tvo≈ôen√≠ prob√≠h√° v d√≠lnƒõ (chatu). Dole je ‚ÄûOdkl√°dac√≠ st≈Øl‚Äú pro rozpracovan√© vƒõci.
        </p>
      </div>

      <div class="pillrow" aria-label="Stav a tarif">
        <div class="pill"><span class="dot"></span> <b>≈Ωivƒõ:</b> DEMO</div>
        <div class="pill">‚ú® Lumina: <b>kreativn√≠ re≈æim</b></div>

        <div class="pill" title="Demo p≈ôep√≠naƒç tarifu">
          üí≥ Tarif:
          <span class="seg" role="group" aria-label="Tarif">
            <button id="planFree" type="button">Free</button>
            <button id="planPlus" type="button">Plus</button>
            <button id="planPremium" type="button">Premium</button>
          </span>
        </div>
      </div>
    </section>

    <main>
      <section class="card" aria-label="Kreativn√≠ studio">
        <div class="hd">
          <div class="title">
            <strong>üõ† D√≠lna</strong>
            <span>Chat je centrum cel√©ho dƒõn√≠. Odkl√°dac√≠ st≈Øl dr≈æ√≠ rozpracovan√© vƒõci pohromadƒõ.</span>
          </div>
          <div class="actions">
            <button class="btn ghost" id="btnExport" title="St√°hnout obsah odkl√°dac√≠ho stolu jako .txt">‚¨áÔ∏è Export</button>
            <button class="btn" id="btnClear" title="Vyƒçistit chat + odkl√°dac√≠ st≈Øl">üßπ Vyƒçistit</button>
          </div>
        </div>

        <div class="studio">
          <div class="chatlog" id="chatlog" aria-live="polite" aria-label="Zpr√°vy chatu"></div>

          <div class="composer" aria-label="Vstup do chatu">
            <input id="chatInput" type="text" placeholder="Napi≈° sem, co chce≈° vytvo≈ôit nebo vyber n√°strojüëá‚Ä¶">
            <button class="btn primary" id="btnSend">‚ú® Poslat</button>
          </div>

          <div class="toolsection" aria-label="N√°stroje">
            <div class="toolhint">üè¢ Kancel√°≈ôsk√© n√°stroje</div>
            <div class="toolrow" aria-label="Kancel√°≈ôsk√© n√°stroje">
              <button class="btn" id="btnEmail">üìß E-mail</button>
              <button class="btn" id="btnTranslate">üåç P≈ôeklad</button>
              <button class="btn" id="btnAttach">üìé P≈ôidat soubor</button>
              <button class="btn" id="btnNote">üìù Odlo≈æit pozn√°mku</button>
              <input id="fileInput" type="file" multiple hidden />
            </div>

            <div class="toolhint" style="margin-top:10px;">üé® Kreativn√≠ n√°stroje</div>
            <div class="toolrow" aria-label="Kreativn√≠ n√°stroje">
              <button class="btn" id="btnSuggest">üí° N√°pady</button>
              <button class="btn" id="btnImageFlow">üñº Generov√°n√≠ obr√°zk≈Ø</button>
            </div>

            <div class="toolhint">
              ‚ú® Tip: Vƒõci, kter√© nechce≈° ztratit v proudu chatu, odlo≈æ na st≈Øl üóÉÔ∏è
            </div>
          </div>

          <div class="shelf" aria-label="Odkl√°dac√≠ st≈Øl">
            <div class="shelfLabel">
              <span>üóÉÔ∏è Odkl√°dac√≠ st≈Øl (rozpracov√°no)</span>
              <span id="planHint" style="color: rgba(234,247,246,.65); font-weight: 780;"></span>
            </div>

            <div class="shelfFilters" id="shelfFilters" aria-label="Filtr odkl√°dac√≠ho stolu">
              <button type="button" class="chip is-active" data-topic="__all">V≈°echno</button>
              <button type="button" class="chip" data-topic="__none">Bez t√©matu</button>
              <div class="chipRow" id="topicChips"></div>
            </div>

            <div class="shelfWrap" id="shelfWrap">
              <div class="feed" id="feed">
                <div class="empty" id="feedEmpty">Zat√≠m tu nic nele≈æ√≠. P≈ôidej pozn√°mku, soubor, nebo obr√°zek ‚ú®</div>
              </div>
            </div>
          </div>

        </div>
      </section>
    </main>

    <footer>
      <div>DEMO ‚Ä¢ ukl√°d√°n√≠ prob√≠h√° lok√°lnƒõ v prohl√≠≈æeƒçi.</div>
      <div>Proiecta ‚Ä¢ üì∫ Projekty</div>
    </footer>
  </div>

  <!-- MODALS -->
  <div class="modalOverlay" id="clearModal" role="dialog" aria-modal="true" aria-labelledby="clearTitle">
    <div class="modal">
      <div class="modalHd">
        <div>
          <strong id="clearTitle">üßπ Vyƒçistit studio?</strong>
          <span>Vyƒçist√≠ se d√≠lna i odkl√°dac√≠ st≈Øl.</span>
        </div>
        <button class="xBtn" data-close="clearModal" aria-label="Zav≈ô√≠t">‚úï</button>
      </div>
      <div class="modalBd">
        <p>Opravdu vyƒçistit? Nerozmysl√≠≈° si to üòâ</p>
        <div class="modalBtns">
          <button class="btn" data-close="clearModal">Nechat b√Ωt</button>
          <button class="btn primary" id="btnConfirmClear">Ano, vyƒçistit</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modalOverlay" id="imgModal" role="dialog" aria-modal="true" aria-labelledby="imgTitle">
    <div class="modal">
      <div class="modalHd">
        <div>
          <strong id="imgTitle">üñºÔ∏è N√°hled</strong>
          <span id="imgSubtitle">Klikni na obr√°zek</span>
        </div>
        <button class="xBtn" data-close="imgModal" aria-label="Zav≈ô√≠t">‚úï</button>
      </div>
      <div class="modalBd">
        <div class="imgFrame" id="imgFrame"></div>
        <div class="modalBtns">
          <button class="btn" data-close="imgModal">Zav≈ô√≠t</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modalOverlay" id="noteModal" role="dialog" aria-modal="true" aria-labelledby="noteTitle">
  <div class="modal">
    <div class="modalHd">
      <div>
        <strong id="noteTitle">üìù Odlo≈æit pozn√°mku</strong>
        <span>Kr√°tce a p≈ôehlednƒõ. Kdykoli se k tomu m≈Ø≈æe≈° vr√°tit.</span>
      </div>
      <button class="xBtn" data-close="noteModal" aria-label="Zav≈ô√≠t">‚úï</button>
    </div>
    <div class="modalBd">
      <div class="grid2">
        <div>
          <p style="margin-top:0"><b>N√°zev</b></p>
          <input
            id="noteTitleInput"
            type="text"
            style="width:100%; padding:12px 12px; border-radius:14px; border:1px solid rgba(255,255,255,.14); background: rgba(0,0,0,.16); color: var(--ink); outline:none;"
            placeholder="Nap≈ô. ‚ÄòText na web ‚Äì zajistit spr√°vn√© zobrazen√≠‚Äô">
        </div>
        <div>
          <p style="margin-top:0"><b>Typ</b></p>
          <div class="toolrow" style="margin-top:0">
            <button class="btn" type="button" data-note-type="idea">üí° N√°pad</button>
            <button class="btn" type="button" data-note-type="task">‚úÖ √ökol</button>
            <button class="btn" type="button" data-note-type="note">üìù Pozn√°mka</button>
          </div>
          <div class="toolhint">
            Vybran√Ω typ: <span id="noteTypeHint">üìù Pozn√°mka</span>
          </div>
        </div>
      </div>

      <p><b>Obsah</b></p>
      <textarea id="noteBodyInput" placeholder="Napi≈° pozn√°mku‚Ä¶"></textarea>

      <p><b>T√©ma / ≈°upl√≠k (voliteln√©)</b></p>
      <input
        id="noteTopicInput"
        type="text"
        style="width:100%; padding:12px 12px; border-radius:14px; border:1px solid rgba(255,255,255,.14); background: rgba(0,0,0,.16); color: var(--ink); outline:none;"
        placeholder="Nap≈ô. ‚Äòlet√°k‚Äô, ‚Äòweb‚Äô, ‚Äò≈°kola‚Äô‚Ä¶">
      <div class="toolhint">
        T√©ma ti pom≈Ø≈æe seskupit vƒõci na odkl√°dac√≠m stole do jednoho ≈°upl√≠ku üóÇÔ∏è
      </div>

      <div class="modalBtns">
        <button class="btn" data-close="noteModal">Zru≈°it</button>
        <button class="btn primary" id="btnSaveNote">Odlo≈æit na st≈Øl üóÉÔ∏è</button>
      </div>
    </div>
  </div>
</div>

  <div class="modalOverlay" id="imageFlowModal" role="dialog" aria-modal="true" aria-labelledby="imgFlowTitle">
    <div class="modal">
      <div class="modalHd">
        <div>
          <strong id="imgFlowTitle">üñºÔ∏è Generov√°n√≠ obr√°zku</strong>
          <span>Napi≈° zad√°n√≠ a ode≈°li. V demo verzi m√° Lumina pro tebe p≈ôipraven√Ωch p√°r obr√°zk≈Ø.</span>
        </div>
        <button class="xBtn" data-close="imageFlowModal" aria-label="Zav≈ô√≠t">‚úï</button>
      </div>
      <div class="modalBd">
        <p><b>Zad√°n√≠</b></p>
        <textarea id="imgPromptInput" placeholder="Nap≈ô. ‚Äòpavuƒçina, Lumina, chaos, ...‚Äô"></textarea>
        <div class="modalBtns">
          <button class="btn" data-close="imageFlowModal">Zru≈°it</button>
          <button class="btn primary" id="btnSendImagePrompt">Odeslat üé®</button>
        </div>
        <div class="toolhint" id="imgFlowStatus" aria-live="polite"></div>
      </div>
    </div>
  </div>

  <div class="modalOverlay" id="moveModal" role="dialog" aria-modal="true" aria-labelledby="moveTitle">
    <div class="modal">
      <div class="modalHd">
        <div>
          <strong id="moveTitle">üì¶ P≈ôesun do projektu</strong>
          <span id="moveSubtitle">DEMO logika podle tarifu.</span>
        </div>
        <button class="xBtn" data-close="moveModal" aria-label="Zav≈ô√≠t">‚úï</button>
      </div>
      <div class="modalBd">
        <p style="margin-top:0"><b>Vyber projekt</b></p>
        <div class="toolrow" id="projectButtons" style="margin-top:0"></div>
        <div class="toolhint" id="moveHint"></div>
        <div class="modalBtns">
          <button class="btn" data-close="moveModal">Zav≈ô√≠t</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modalOverlay" id="topicModal" role="dialog" aria-modal="true" aria-labelledby="topicTitle">
    <div class="modal">
      <div class="modalHd">
        <div>
          <strong id="topicTitle">üóÇ T√©ma / ≈°upl√≠k</strong>
          <span>Nastav nebo uprav ≈°upl√≠k, do kter√©ho tahle vƒõc pat≈ô√≠.</span>
        </div>
        <button class="xBtn" data-close="topicModal" aria-label="Zav≈ô√≠t">‚úï</button>
      </div>
      <div class="modalBd">
        <p><b>N√°zev ≈°upl√≠ku</b></p>
        <input id="topicInput" type="text" style="width:100%; padding:12px 12px; border-radius:14px; border:1px solid rgba(255,255,255,.14); background: rgba(0,0,0,.16); color: var(--ink); outline:none;" placeholder="Nap≈ô. ‚Äòlet√°k‚Äô, ‚Äòweb‚Äô, ‚Äò≈°kola‚Äô‚Ä¶">
        <div class="toolhint" id="topicHint">Nech pr√°zdn√©, pokud nechce≈° m√≠t t√©ma p≈ôi≈ôazen√©.</div>
        <div class="modalBtns">
          <button class="btn" data-close="topicModal">Zru≈°it</button>
          <button class="btn primary" id="btnSaveTopic">Ulo≈æit</button>
        </div>
      </div>
    </div>
  </div>

<script>
(() => {
  const KEY = "LM_PROIECTA_STUDIO";
const PLAN_KEY = "LM_PLAN";
const KEY_QUEUE = "LM_PROIECTA_QUEUE_DEMO_CS";

  const PRESET_IMAGES = [
    { src: "cat-cleanup-mission.png", title: "cat-cleanup-mission.png" },
    { src: "creative-kitchen-chaos.png", title: "creative-kitchen-chaos.png" },
    { src: "ideas-in-the-air.png", title: "ideas-in-the-air.png" },
    { src: "lumina-robot-sketch.png", title: "lumina-robot-sketch.png" },
    { src: "night-protection.png", title: "night-protection.png" }
  ];

  const GEN_LINES = [
    "Chvilku‚Ä¶ tvo≈ô√≠m üé®",
    "D√°me tomu trochu barvy, a≈• to nevypad√° jak zubn√≠ ordinace. üé®üòÑ",
    "Ok‚Ä¶ zpracov√°v√°m ‚ú®",
    "Je≈°tƒõ moment‚Ä¶ üëÄ"
  ];

  const state = loadState();
  let plan = loadPlan(); // free | plus | premium
  let activeTopicFilter = "__all";

  const chatlog = document.getElementById("chatlog");
  const chatInput = document.getElementById("chatInput");
  const btnSend = document.getElementById("btnSend");

  const btnTranslate = document.getElementById("btnTranslate");
  const btnSuggest = document.getElementById("btnSuggest");
  const btnEmail = document.getElementById("btnEmail");
  const btnImageFlow = document.getElementById("btnImageFlow");
  const btnNote = document.getElementById("btnNote");
  const btnAttach = document.getElementById("btnAttach");
  const fileInput = document.getElementById("fileInput");

  const btnClear = document.getElementById("btnClear");
  const btnExport = document.getElementById("btnExport");

  const feed = document.getElementById("feed");
  const feedEmpty = document.getElementById("feedEmpty");
  const planHint = document.getElementById("planHint");
  const shelfFilters = document.getElementById("shelfFilters");
  const topicChips = document.getElementById("topicChips");

  // Plan buttons
  const planFree = document.getElementById("planFree");
  const planPlus = document.getElementById("planPlus");
  const planPremium = document.getElementById("planPremium");

  function loadPlan(){
  try{
    // 1) prim√°rnƒõ tarif z mini-loginu
    const raw = localStorage.getItem("lm_plan") || localStorage.getItem(PLAN_KEY);
    if(raw === "free" || raw === "plus" || raw === "premium") return raw;

    // kdyby n√°hodou bylo ulo≈æen√© jako FREE/PLUS/PREMIUM
    const up = String(raw || "").toUpperCase();
    if(up === "FREE" || up === "PLUS" || up === "PREMIUM"){
      return up.toLowerCase();
    }
  }catch(_){
    // ignore
  }
  return "free";
}

function savePlan(){
  try{
    // hlavn√≠ kl√≠ƒç, kter√Ω pou≈æ√≠v√° mini-login + Sigma
    localStorage.setItem("lm_plan", plan);
    // z√°loha pro Proiectu (pro jistotu)
    localStorage.setItem(PLAN_KEY, plan);
  }catch(_){}
}

  function setPlan(p){
    plan = p;
    savePlan();
    updatePlanUI();
    addChat("lumina",
      plan === "free"
        ? "Nastaveno: Free (1 projekt) ‚úÖ"
        : plan === "plus"
          ? "Nastaveno: Plus (a≈æ 5 projekt≈Ø) ‚úÖ"
          : "Nastaveno: Premium (bez limitu) ‚úÖ",
      "tarif"
    );
  }
  function updatePlanUI(){
    planFree.classList.toggle("active", plan === "free");
    planPlus.classList.toggle("active", plan === "plus");
    planPremium.classList.toggle("active", plan === "premium");
    planHint.textContent =
      plan === "free" ? "Free: 1 projekt"
      : plan === "plus" ? "Plus: 5 projekt≈Ø"
      : "Premium: ‚àû projekt≈Ø";
  }

  planFree.addEventListener("click", () => setPlan("free"));
  planPlus.addEventListener("click", () => setPlan("plus"));
  planPremium.addEventListener("click", () => setPlan("premium"));

  // Modals helpers
  function openModal(el){
    el.classList.add("show");
    document.documentElement.style.overflow = "hidden";
    document.body.style.overflow = "hidden";
  }
  function closeModal(el){
    el.classList.remove("show");
    document.documentElement.style.overflow = "";
    document.body.style.overflow = "";
  }

  document.addEventListener("click", (e) => {
    const closeId = e.target.closest("[data-close]")?.getAttribute("data-close");
    if(closeId){
      const el = document.getElementById(closeId);
      if(el) closeModal(el);
    }
    const overlay = e.target.classList?.contains("modalOverlay") ? e.target : null;
    if(overlay && overlay.classList.contains("show")) closeModal(overlay);
  });

  document.addEventListener("keydown", (e) => {
    if(e.key === "Escape"){
      const shown = document.querySelector(".modalOverlay.show");
      if(shown) closeModal(shown);
    }
  });

  // Image preview modal
  const imgModal = document.getElementById("imgModal");
  const imgFrame = document.getElementById("imgFrame");
  const imgTitle = document.getElementById("imgTitle");
  const imgSubtitle = document.getElementById("imgSubtitle");

  function openImageModal(src, alt){
    if(!src) return;
    imgTitle.textContent = "üñºÔ∏è " + (alt || "N√°hled");
    imgSubtitle.textContent = "Klikni na obr√°zek pro zav≈ôen√≠.";
    imgFrame.innerHTML = `<img src="${src}" alt="${escapeHtml(alt||"obr√°zek")}">`;
    openModal(imgModal);
  }
  imgFrame.addEventListener("click", () => closeModal(imgModal));

  // State
  function loadState(){
    try{
      const raw = localStorage.getItem(KEY);
      if(!raw) return { chat: [], items: [] };
      const parsed = JSON.parse(raw);
      return { chat: parsed.chat || [], items: parsed.items || [] };
    }catch(e){
      return { chat: [], items: [] };
    }
  }
  function saveState(){
    localStorage.setItem(KEY, JSON.stringify(state));
  }
  function cryptoId(){
    try { return crypto.randomUUID(); } catch(e) { return String(Math.random()).slice(2) + String(Date.now()); }
  }
  function escapeHtml(s){
    return (s||"").replace(/[&<>"']/g, m => ({ "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#039;" }[m]));
  }

  // Chat + Shelf
  function addChat(role, text, tag, extra){
    state.chat.push({ id: cryptoId(), role, text, tag: tag || "", extra: extra || {}, ts: Date.now() });
    saveState();
    renderChat();
  }

  function addItem(type, title, body, extra){
    const id = cryptoId();
    state.items.unshift({ id, type, title: title || "", body: body || "", extra: extra || {}, ts: Date.now() });
    saveState();
    renderFeed();
    return id;
  }

  function typeLabel(type){
    if(type === "image") return "Obr√°zek";
    if(type === "file") return "Soubor";
    if(type === "idea") return "N√°pad";
    if(type === "task") return "√ökol";
    if(type === "note") return "Pozn√°mka";
    return "Z√°znam";
  }

  function renderChat(){
    chatlog.innerHTML = "";

    if(state.chat.length === 0){
      state.chat.push({
        id: cryptoId(),
        role: "lumina",
        text: "V√≠tej v d√≠lnƒõ. üõ† J√° jsem tu na dozor üï∂Ô∏è, aby v≈°e prob√≠halo bez chaosu. Tady spolu vytvo≈ô√≠me velk√© vƒõci. ‚ù§Ô∏è",
        tag: "d√≠lna",
        extra: {},
        ts: Date.now()
      });
      saveState();
    }

    for(const m of state.chat){
      const wrap = document.createElement("div");
      wrap.className = "msg";

      const av = document.createElement("div");
      av.className = "avatar";

      if(m.role === "lumina"){
        av.innerHTML = `<img src="lumina-avatar.png" alt="Lumina">`;
      }else{
        av.innerHTML = `<span class="letter">üë§</span>`;
      }
      wrap.appendChild(av);

      const bubble = document.createElement("div");
      bubble.className = "bubble" + (m.role === "user" ? " user" : "");

      const time = new Date(m.ts).toLocaleTimeString("cs-CZ",{hour:"2-digit", minute:"2-digit"});

      let inner = `
        <p>${escapeHtml(m.text)}</p>
        <div class="meta">
          <span>${time}</span>
          ${m.tag ? `<span class="tag">üï∏ ${escapeHtml(m.tag)}</span>` : ""}
        </div>
      `;

      if(m.extra && m.extra.attachments && Array.isArray(m.extra.attachments) && m.extra.attachments.length){
        const row = document.createElement("div");
        row.className = "thumbRow";

        for(const a of m.extra.attachments){
          if(a.kind === "image" && a.src){
            const box = document.createElement("div");
            box.className = "thumbMini";
            box.innerHTML = `<img src="${a.src}" alt="${escapeHtml(a.name||"obr√°zek")}" loading="lazy">`;
            box.addEventListener("click", () => openImageModal(a.src, a.name || "Obr√°zek"));
            row.appendChild(box);
          }else if(a.kind === "file"){
            const chip = document.createElement("a");
            chip.className = "fileChip";
            chip.href = a.downloadUrl || "#";
            chip.download = a.name || "soubor";
            chip.target = "_blank";
            chip.rel = "noopener";
            chip.innerHTML = `üìé ${escapeHtml(a.name || "soubor")} <small>${escapeHtml(a.info || "")}</small>`;
            if(!a.downloadUrl){
              chip.addEventListener("click", (e) => {
                e.preventDefault();
                addChat("lumina", "Soubor je ulo≈æen√Ω jako z√°znam na stole (DEMO). ‚úÖ", "soubor");
              });
            }
            row.appendChild(chip);
          }
        }

        bubble.innerHTML = inner;
        bubble.appendChild(row);
      }else{
        bubble.innerHTML = inner;
      }

      wrap.appendChild(bubble);
      chatlog.appendChild(wrap);
    }

    chatlog.scrollTop = chatlog.scrollHeight;
  }

  function renderFeed(){
    feed.innerHTML = "";

    const items = state.items.filter(it => {
      const topic = (it.extra && it.extra.topic || "").trim();
      if(activeTopicFilter === "__all") return true;
      if(activeTopicFilter === "__none") return !topic;
      return topic === activeTopicFilter;
    });

    if(items.length === 0){
      feed.appendChild(feedEmpty);
      feedEmpty.style.display = "block";
    }else{
      feedEmpty.style.display = "none";

      for(const it of items){
        const el = document.createElement("div");
        el.className = "item";
        const ts = new Date(it.ts).toLocaleString("cs-CZ", { hour:"2-digit", minute:"2-digit" });

        const subtitle =
          it.type === "image" ? "Vizu√°ln√≠ polo≈æka (DEMO)"
          : it.type === "file" ? "P≈ô√≠loha (DEMO)"
          : "Rozpracov√°no (DEMO)";

        const topic = (it.extra && it.extra.topic || "").trim();
        const topicMarkup = topic ? `<span class="itemTopic">üóÇ ${escapeHtml(topic)}</span>` : "";

        el.innerHTML = `
          <div class="top">
            <div style="display:flex; align-items:flex-start; min-width:0; flex:1;">
              <span class="badge">${typeLabel(it.type)}</span>
              <div class="itTitle">
                <strong>${escapeHtml(it.title || "Bez n√°zvu")}</strong>
                <span>${escapeHtml(subtitle)} ‚Ä¢ ${ts}</span>
                ${topicMarkup}
              </div>
            </div>
            <div class="itemActions">
              <button class="linkbtn ghost" data-act="move" data-id="${it.id}">üì¶ Do projektu</button>
              <button class="linkbtn" data-act="copy" data-id="${it.id}">üìã Kop√≠rovat</button>
              <button class="linkbtn" data-act="topic" data-id="${it.id}">üóÇ T√©ma</button>
              <button class="linkbtn" data-act="done" data-id="${it.id}">‚úÖ Hotovo</button>
              <button class="linkbtn danger" data-act="del" data-id="${it.id}">üóë Smazat</button>
            </div>
          </div>
          <div class="body">${escapeHtml(it.body || "")}</div>
        `;

        if(it.type === "image" && it.extra && it.extra.src){
          const row = document.createElement("div");
          row.className = "thumbRow";

          const box = document.createElement("div");
          box.className = "thumbMini";
          box.style.width = "220px";
          box.innerHTML = `<img src="${it.extra.src}" alt="${escapeHtml(it.title||"obr√°zek")}" loading="lazy">`;
          box.addEventListener("click", () => openImageModal(it.extra.src, it.title || "Obr√°zek"));
          row.appendChild(box);

          el.appendChild(row);
        }

        if(it.extra && it.extra.thumb){
          const row = document.createElement("div");
          row.className = "thumbRow";
          const box = document.createElement("div");
          box.className = "thumbMini";
          box.style.width = "220px";
          box.innerHTML = `<img src="${it.extra.thumb}" alt="${escapeHtml(it.title||"n√°hled")}" loading="lazy">`;
          box.addEventListener("click", () => openImageModal(it.extra.thumb, it.title || "N√°hled"));
          row.appendChild(box);
          el.appendChild(row);
        }

        if(it.type === "file" && it.extra && it.extra.downloadUrl){
          const row = document.createElement("div");
          row.className = "thumbRow";
          const a = document.createElement("a");
          a.className = "fileChip";
          a.href = it.extra.downloadUrl;
          a.download = it.title || "soubor";
          a.target = "_blank";
          a.rel = "noopener";
          a.innerHTML = `‚¨áÔ∏è St√°hnout: ${escapeHtml(it.title || "soubor")} <small>${escapeHtml(it.extra.info || "")}</small>`;
          row.appendChild(a);
          el.appendChild(row);
        }

        feed.appendChild(el);
      }
    }

    rebuildTopicChips();
  }

  function rebuildTopicChips(){
    if(!shelfFilters || !topicChips) return;

    const topics = new Set();
    for(const it of state.items){
      const t = (it.extra && it.extra.topic || "").trim();
      if(t) topics.add(t);
    }

    topicChips.innerHTML = "";
    topics.forEach(topic => {
      const btn = document.createElement("button");
      btn.type = "button";
      btn.className = "chip";
      btn.dataset.topic = topic;
      btn.textContent = topic;
      topicChips.appendChild(btn);
    });

    const allButtons = shelfFilters.querySelectorAll("[data-topic]");
    allButtons.forEach(btn => {
      const val = btn.getAttribute("data-topic") || "";
      if(val === activeTopicFilter){
        btn.classList.add("is-active");
      }else{
        btn.classList.remove("is-active");
      }
    });
  }

  if(shelfFilters){
    shelfFilters.addEventListener("click", (e) => {
      const btn = e.target.closest("[data-topic]");
      if(!btn) return;
      activeTopicFilter = btn.getAttribute("data-topic") || "__all";
      rebuildTopicChips();
      renderFeed();
    });
  }

      // Shelf actions
  const moveModal = document.getElementById("moveModal");
  const projectButtons = document.getElementById("projectButtons");
  const moveHint = document.getElementById("moveHint");
  let moveItemId = null;

  const topicModal = document.getElementById("topicModal");
  const topicInput = document.getElementById("topicInput");
  const topicHint = document.getElementById("topicHint");
  const btnSaveTopic = document.getElementById("btnSaveTopic");
  let topicEditId = null;

  function projectLimit(){
    if(plan === "free") return 1;
    if(plan === "plus") return 5;
    return Infinity;
  }

  // Bridge do Proiecta-projekty ‚Äì fronta odkl√°dac√≠ho stolu
  function loadQueue(){
    try{
      const raw = localStorage.getItem(KEY_QUEUE);
      if(!raw) return [];
      const parsed = JSON.parse(raw);
      return Array.isArray(parsed) ? parsed : [];
    }catch(_){
      return [];
    }
  }

  function saveQueue(q){
    try{
      localStorage.setItem(KEY_QUEUE, JSON.stringify(q || []));
    }catch(_){
      // ignore
    }
  }

  function pushItemToQueue(item){
    if(!item) return null;

    const topic = (item.extra && item.extra.topic || "").trim();
    const label = topic || item.title || typeLabel(item.type);
    const text = item.body || "";

    const q = loadQueue();
    q.unshift({
      id: cryptoId(),
      title: label,
      topic,
      text,
      source: "proiecta-studio",
      createdAt: Date.now()
    });
    saveQueue(q);
    return label;
  }

  function openMoveModal(){
    if(!moveModal || !projectButtons || !moveHint) return;

    const item = state.items.find(x => x.id === moveItemId) || null;

    projectButtons.innerHTML = "";
    moveHint.textContent = "";

    const btn = document.createElement("button");
    btn.className = "btn primary";
    btn.type = "button";
    btn.textContent = "üì¶ Odeslat na odkl√°dac√≠ st≈Øl v projektech";
    btn.addEventListener("click", () => {
      const label = pushItemToQueue(item);
      if(label){
        addChat(
          "lumina",
          `P≈ôid√°no na odkl√°dac√≠ st≈Øl v Proiecta ‚Üí Projekty jako ‚Äû${label}‚Äú. ‚úÖ`,
          "projekty"
        );
        moveHint.textContent = "Hotovo ‚úÖ ‚Äì najde≈° to v sekci Proiecta ‚Üí Projekty.";
      }else{
        moveHint.textContent = "Nepovedlo se ulo≈æit polo≈æku. Zkus to pros√≠m je≈°tƒõ jednou.";
      }
    });
    projectButtons.appendChild(btn);

    const lim = projectLimit();
    const planText =
      lim === Infinity
        ? "Tarif PREMIUM ‚Äì ≈æ√°dn√Ω pevn√Ω limit poƒçtu projekt≈Ø (v ostr√© verzi)."
        : `Tarif ${plan.toUpperCase()} ‚Äì v ostr√© verzi omezen√Ω poƒçet projektov√Ωch m√≠stnost√≠.`;
    moveHint.textContent = planText;

    openModal(moveModal);
  }

  // Ulo≈æen√≠ t√©matu polo≈æky (üóÇ T√©ma)
  if(btnSaveTopic && topicModal && topicInput){
    btnSaveTopic.addEventListener("click", () => {
      const it = state.items.find(x => x.id === topicEditId);
      if(!it){
        topicHint.textContent = "Polo≈æka u≈æ neexistuje. Zkus to znovu.";
        return;
      }
      const val = (topicInput.value || "").trim();
      if(!it.extra) it.extra = {};
      it.extra.topic = val;
      saveState();
      renderFeed();
      topicHint.textContent = "T√©ma ulo≈æen√©. üòä";
      setTimeout(() => {
        topicHint.textContent = "";
        closeModal(topicModal);
      }, 600);
    });
  }

  // Kliky na odkl√°dac√≠m stole
  feed.addEventListener("click", async (e) => {
    const btn = e.target.closest("button[data-act]");
    if(!btn) return;

    const id = btn.getAttribute("data-id");
    const act = btn.getAttribute("data-act");
    const idx = state.items.findIndex(x => x.id === id);
    if(idx < 0) return;

    const it = state.items[idx];

    if(act === "del"){
      state.items.splice(idx,1);
      saveState();
      renderFeed();
      addChat("lumina", "Smaz√°no üßπ", "st≈Øl");
      return;
    }

    if(act === "copy"){
      try{
        await navigator.clipboard.writeText(
          (it.title ? it.title + "\n" : "") + (it.body || "")
        );
        addChat("lumina", "Zkop√≠rov√°no üìã", "st≈Øl");
      }catch(err){
        addChat(
          "lumina",
          "Kop√≠rov√°n√≠ se nepovedlo (prohl√≠≈æeƒç to nƒõkdy blokuje). üôà",
          "st≈Øl"
        );
      }
      return;
    }

    if(act === "move"){
      moveItemId = id;
      openMoveModal();
      return;
    }

    if(act === "done"){
      const topic = (it.extra && it.extra.topic || "").trim();
      const label = topic || it.title || typeLabel(it.type);
      state.items.splice(idx,1);
      saveState();
      renderFeed();
      addChat("lumina", `Beru ‚Äû${label}‚Äú jako vy≈ô√≠zen√© a uklizen√© ze stolu. ‚úÖ`, "st≈Øl");
      return;
    }

    if(act === "topic"){
      topicEditId = id;
      if(topicInput){
        const current = (it.extra && it.extra.topic || "").trim();
        topicInput.value = current;
        topicHint.textContent = current
          ? "Zmƒõ≈à n√°zev ≈°upl√≠ku, nebo nech pr√°zdn√© pro odebr√°n√≠ t√©matu."
          : "Voliteln√©. Kr√°tk√Ω n√°zev ≈°upl√≠ku ‚Äì nap≈ô. ‚Äûlet√°k‚Äú, ‚Äûweb‚Äú, ‚Äû≈°kola‚Äú‚Ä¶";
      }
      openModal(topicModal);
      return;
    }
  });

  // Sending
  function sendUser(){
    const text = (chatInput.value || "").trim();
    if(!text) return;
    chatInput.value = "";
    addChat("user", text, "");

    setTimeout(() => {
      addChat("lumina", "Zaps√°no ‚úÖ Chce≈° z toho udƒõlat e-mail, n√°vrhy, p≈ôeklad, nebo to odlo≈æit na st≈Øl?", "d√≠lna");
    }, 360);
  }

  btnSend.addEventListener("click", sendUser);
  chatInput.addEventListener("keydown", (e) => {
    if(e.key === "Enter") sendUser();
  });

  // Quick tools (neutr√°ln√≠ hl√°≈°ky)
  btnTranslate.addEventListener("click", () => {
    addChat("lumina", "Po≈°li text toho co chce≈° p≈ôelo≈æit a do jak√©ho jazyka to bude üåç - v demo verzi neƒçekej z√°zraky, proto≈æe si mus√≠m je≈°tƒõ nastudovat slovn√≠ky. üòÇ", "p≈ôeklad");
  });

  btnSuggest.addEventListener("click", () => {
    addChat("lumina", "Napi≈° jednou vƒõtou, co chce≈° vymyslet. P≈ôiprav√≠m nƒõkolik variant üí°", "n√°pady");
  });

  btnEmail.addEventListener("click", () => {
    addChat("lumina", "Napi≈°, o jak√Ω e-mail jde a jak√Ω t√≥n chce≈° üìß", "e-mail");
  });

  // Note modal
  const noteModal = document.getElementById("noteModal");
  const noteTitleInput = document.getElementById("noteTitleInput");
  const noteBodyInput = document.getElementById("noteBodyInput");
  const noteTopicInput = document.getElementById("noteTopicInput");
  const btnSaveNote = document.getElementById("btnSaveNote");
  const noteTypeHint = document.getElementById("noteTypeHint");
  let noteType = "note";

  function setNoteType(t){
    noteType = t;
    noteTypeHint.textContent = (t === "idea") ? "üí° N√°pad" : (t === "task") ? "‚úÖ √ökol" : "üìù Pozn√°mka";
  }

  noteModal.addEventListener("click", (e) => {
    const b = e.target.closest("button[data-note-type]");
    if(!b) return;
    setNoteType(b.getAttribute("data-note-type"));
  });

  btnNote.addEventListener("click", () => {
    setNoteType("note");
    noteTitleInput.value = "";
    noteBodyInput.value = "";
    if(noteTopicInput) noteTopicInput.value = "";
    openModal(noteModal);
  });

  btnSaveNote.addEventListener("click", () => {
    const t = (noteTitleInput.value || "").trim();
    const body = (noteBodyInput.value || "").trim();
    const topic = (noteTopicInput && noteTopicInput.value || "").trim();
    if(!t && !body){
      addChat("lumina", "Pozn√°mka je pr√°zdn√° üôÇ", "st≈Øl");
      return;
    }
    const title = t || (body.split("\n")[0].slice(0, 52) || "Bez n√°zvu");
    const extra = topic ? { topic } : {};
    addItem(noteType, title, body || "(bez obsahu)", extra);
    addChat(
      "lumina",
      topic
        ? `Odlo≈æeno na st≈Øl do ≈°upl√≠ku ‚Äû${topic}‚Äú. üóÉÔ∏è`
        : "Odlo≈æeno na st≈Øl üóÉÔ∏è",
      "st≈Øl"
    );
    closeModal(noteModal);
  });

  // Image flow modal (DEMO)
  const imageFlowModal = document.getElementById("imageFlowModal");
  const imgPromptInput = document.getElementById("imgPromptInput");
  const btnSendImagePrompt = document.getElementById("btnSendImagePrompt");
  const imgFlowStatus = document.getElementById("imgFlowStatus");

  btnImageFlow.addEventListener("click", () => {
    imgFlowStatus.textContent = "";
    imgPromptInput.value = "";
    openModal(imageFlowModal);
  });

  btnSendImagePrompt.addEventListener("click", () => {
    const prompt = (imgPromptInput.value || "").trim();
    if(!prompt){
      imgFlowStatus.textContent = "Napi≈° pros√≠m zad√°n√≠ üôÇ";
      return;
    }

    closeModal(imageFlowModal);

    addChat("user", "Zad√°n√≠ obr√°zku: " + prompt, "");
    addChat("lumina", GEN_LINES[Math.floor(Math.random() * GEN_LINES.length)], "generov√°n√≠");

    setTimeout(() => {
      const pick = PRESET_IMAGES[Math.floor(Math.random() * PRESET_IMAGES.length)];
      addChat("lumina", "V√Ωsledek (DEMO) üñºÔ∏è", "generov√°n√≠", {
        attachments: [{ kind:"image", src: pick.src, name: pick.title }]
      });
      addItem("image", "Generovan√Ω obr√°zek", "Zad√°n√≠: " + prompt, { src: pick.src, preset: true });
    }, 2200 + Math.floor(Math.random()*900));
  });

  // Attach files
  btnAttach.addEventListener("click", () => fileInput.click());

  fileInput.addEventListener("change", async (e) => {
    const files = Array.from(e.target.files || []);
    if(!files.length) return;

    const attachments = [];

    addChat("lumina", "P≈ô√≠loha se p≈ôid√°v√°‚Ä¶ üìé", "soubor");

    for(const f of files){
      const info = `${(f.size/1024).toFixed(1)} KB`;
      const isImg = /^image\//.test(f.type);

      if(isImg){
        const dataUrl = await readAsDataURL(f);
        attachments.push({ kind:"image", src: dataUrl, name: f.name, info });
        addItem("file", f.name, "P≈ôilo≈æen√Ω obr√°zek (DEMO).", { thumb: dataUrl, mime: f.type, size: f.size, info });
      }else{
        const url = URL.createObjectURL(f);
        attachments.push({ kind:"file", downloadUrl: url, name: f.name, info });
        addItem("file", f.name, "Soubor p≈ôijat (DEMO).", { downloadUrl: url, mime: f.type, size: f.size, info });
      }
    }

    addChat("user", files.length === 1 ? "P≈ôid√°v√°m p≈ô√≠lohu." : `P≈ôid√°v√°m ${files.length} p≈ô√≠loh.`, "", { attachments });
    addChat("lumina", "P≈ôid√°no ‚úÖ", "soubor");

    fileInput.value = "";
  });

  function readAsDataURL(file){
    return new Promise((resolve, reject) => {
      const r = new FileReader();
      r.onload = () => resolve(String(r.result || ""));
      r.onerror = reject;
      r.readAsDataURL(file);
    });
  }

  // Clear
  const clearModal = document.getElementById("clearModal");
  const btnConfirmClear = document.getElementById("btnConfirmClear");

  btnClear.addEventListener("click", () => openModal(clearModal));
  btnConfirmClear.addEventListener("click", () => {
    state.chat = [];
    state.items = [];
    saveState();
    closeModal(clearModal);
    renderChat();
    renderFeed();
    addChat("lumina", "Vyƒçi≈°tƒõno. ‚úÖ V≈°echno to zmizelo, jak pono≈æka v praƒçce. üß¶‚ú®", "reset");
  });

  // Export shelf as txt
  btnExport.addEventListener("click", () => {
    const lines = [];
    lines.push("Proiecta ‚Ä¢ Export odkl√°dac√≠ho stolu (DEMO)");
    lines.push("Tarif: " + plan.toUpperCase());
    lines.push("Datum: " + new Date().toLocaleString("cs-CZ"));
    lines.push("");

    if(!state.items.length){
      lines.push("(St≈Øl je pr√°zdn√Ω.)");
    }else{
      for(const it of state.items){
        lines.push("‚Äî");
        lines.push(typeLabel(it.type) + ": " + (it.title || "Bez n√°zvu"));
        const topic = (it.extra && it.extra.topic || "").trim();
        if(topic) lines.push("T√©ma: " + topic);
        lines.push((it.body || "").trim());
        if(it.extra && it.extra.src) lines.push("[image] " + it.extra.src);
      }
    }

    const blob = new Blob([lines.join("\n")], { type: "text/plain;charset=utf-8" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "proiecta-odkladaci-stul.txt";
    document.body.appendChild(a);
    a.click();
    a.remove();
    setTimeout(() => URL.revokeObjectURL(url), 800);

    addChat("lumina", "Export p≈ôipraven√Ω ‚¨áÔ∏è", "export");
  });

  // Make chat thumbnails clickable
  chatlog.addEventListener("click", (e) => {
    const img = e.target.closest(".thumbMini img");
    if(!img) return;
    openImageModal(img.getAttribute("src") || "", img.getAttribute("alt") || "Obr√°zek");
  });

  // INIT
  updatePlanUI();
  renderChat();
  renderFeed();

  // üí° P≈ôi p≈ôepnut√≠ jazyka vyƒçistit d√≠lnu,
  // aby se nep≈ôen√°≈°ely bubliny z jin√©ho jazyka
  const langLinks = document.querySelectorAll('.lang-switch a');

  langLinks.forEach(link => {
    link.addEventListener('click', () => {
      // vypr√°zdn√≠me chat i polo≈æky d√≠lny
      state.chat = [];
      state.items = [];

      // ulo≈æ√≠me pr√°zdn√Ω stav
      if (typeof saveState === 'function') {
        saveState();
      }
    });
  });

})();

</script>
</body>
</html>